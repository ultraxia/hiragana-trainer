<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>æ—¥è¯­äº”åéŸ³å­¦ä¹  Â· ä¼˜åŒ–åŠ©è®°ç‰ˆ</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Theme Color -->
    <meta name="theme-color" content="#007AFF">
    <meta name="description" content="æ—¥è¯­äº”åéŸ³å­¦ä¹ å·¥å…·">

    <!-- iOS ç‰¹å®šé…ç½® -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="äº”åéŸ³">

    <!-- iOS å›¾æ ‡ -->
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/icon-120x120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180x180.png">

    <!-- iOS å¯åŠ¨ç”»é¢ -->
    <link rel="apple-touch-startup-image" href="icons/icon-512x512.png">

    <!-- æ ‡å‡† Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
            background: #f5f5f7;
            min-height: 100vh;
            padding: 40px 20px;
            color: #1d1d1f;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #1d1d1f;
            margin-bottom: 12px;
            font-size: 3em;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .subtitle {
            text-align: center;
            color: #86868b;
            margin-bottom: 40px;
            font-size: 1.2em;
            font-weight: 400;
        }

        /* åŠŸèƒ½æŒ‰é’®åŒºåŸŸ */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 50px;
            flex-wrap: wrap;
        }

        .action-btn {
            background: white;
            border: none;
            border-radius: 24px;
            padding: 16px 32px;
            font-size: 16px;
            font-weight: 600;
            color: #1d1d1f;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 0.5px solid rgba(0, 0, 0, 0.04);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            background: #fbfbfd;
        }

        .action-btn:active {
            transform: scale(0.98);
        }

        .action-btn.primary {
            background: #007AFF;
            color: white;
        }

        .action-btn.primary:hover {
            background: #0051D5;
        }

        .action-btn.active {
            background: #007AFF;
            color: white;
            border-color: #007AFF;
        }

        .action-btn.active:hover {
            background: #0051D5;
            border-color: #0051D5;
        }

        .action-btn .badge {
            background: rgba(255, 59, 48, 0.15);
            color: #FF3B30;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 700;
        }

        /* æ¨¡å¼åˆ‡æ¢æ ‡ç­¾ */
        .mode-tabs {
            display: flex;
            justify-content: center;
            gap: 0;
            margin-bottom: 32px;
            background: rgba(120, 120, 128, 0.12);
            border-radius: 12px;
            padding: 4px;
            max-width: 320px;
            margin-left: auto;
            margin-right: auto;
        }

        .mode-tab {
            flex: 1;
            background: transparent;
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-size: 15px;
            font-weight: 600;
            color: #86868b;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .mode-tab:hover {
            color: #1d1d1f;
        }

        .mode-tab.active {
            background: white;
            color: #1d1d1f;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .mode-tab.hiragana.active {
            background: linear-gradient(135deg, #007AFF, #5856D6);
            color: white;
        }

        .mode-tab.katakana.active {
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
            color: white;
        }

        .hiragana-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
            margin-bottom: 60px;
        }

        .hiragana-card {
            background: white;
            border-radius: 18px;
            padding: 28px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 0.5px solid rgba(0, 0, 0, 0.04);
            position: relative;
        }

        .hiragana-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            background: #fbfbfd;
        }

        .hiragana-card:active {
            transform: scale(0.98);
        }

        .hiragana-card.error-mark::after {
            content: '!';
            position: absolute;
            top: 8px;
            right: 8px;
            background: #FF3B30;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
        }

        .hiragana-char {
            font-size: 48px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 6px;
            letter-spacing: -0.5px;
        }

        .hiragana-roma {
            font-size: 15px;
            color: #86868b;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        /* Modal æ ·å¼ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1000;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            animation: fadeIn 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-overlay.active {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border-radius: 28px;
            padding: 48px 40px;
            max-width: 480px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            animation: slideUp 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            border: 0.5px solid rgba(255, 255, 255, 0.6);
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(120, 120, 128, 0.16);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            color: #1d1d1f;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 300;
        }

        .close-btn:hover {
            background: rgba(120, 120, 128, 0.24);
            transform: scale(1.05);
        }

        .close-btn:active {
            transform: scale(0.95);
        }

        .modal-char {
            font-size: 96px;
            text-align: center;
            color: #1d1d1f;
            margin-bottom: 16px;
            font-weight: 600;
            letter-spacing: -1px;
        }

        .modal-roma {
            text-align: center;
            font-size: 24px;
            color: #86868b;
            margin-bottom: 40px;
            font-weight: 500;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .modal-section {
            margin-bottom: 24px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: 16px;
            border: 0.5px solid rgba(0, 0, 0, 0.04);
        }

        .modal-section:last-of-type {
            margin-bottom: 0;
        }

        .modal-section.highlight-section {
            background: rgba(255, 149, 0, 0.08);
            border: 1px solid rgba(255, 149, 0, 0.3);
        }

        .modal-label {
            font-size: 13px;
            color: #86868b;
            margin-bottom: 10px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .modal-text {
            font-size: 17px;
            color: #1d1d1f;
            line-height: 1.5;
            font-weight: 400;
        }

        .confusion-item {
            margin-bottom: 12px;
            padding-left: 8px;
        }

        .confusion-item:last-child {
            margin-bottom: 0;
        }

        .confusion-char {
            font-size: 24px;
            font-weight: 600;
            color: #1d1d1f;
            margin-right: 8px;
        }

        .confusion-char-link {
            font-size: 24px;
            font-weight: 600;
            color: #007AFF;
            margin-right: 8px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s;
            border-bottom: 1px solid transparent;
        }

        .confusion-char-link:hover {
            color: #0051D5;
            border-bottom-color: #0051D5;
        }

        .confusion-reason {
            font-size: 16px;
            color: #1d1d1f;
            line-height: 1.6;
        }

        .highlight-parts-list {
            font-size: 17px;
            color: #1d1d1f;
            line-height: 1.8;
        }

        .highlight-parts-item {
            display: inline-block;
            background: rgba(0, 122, 255, 0.1);
            padding: 4px 12px;
            border-radius: 8px;
            margin-right: 8px;
            margin-bottom: 8px;
            font-weight: 500;
        }

        /* éšæœºæ£€æŸ¥æ¨¡å¼ */
        .quiz-container {
            text-align: center;
        }

        .quiz-type-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
            background: rgba(120, 120, 128, 0.12);
            border-radius: 10px;
            padding: 3px;
        }

        .quiz-type-tab {
            flex: 1;
            background: transparent;
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            font-size: 14px;
            font-weight: 600;
            color: #86868b;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .quiz-type-tab:hover {
            color: #1d1d1f;
        }

        .quiz-type-tab.active {
            background: white;
            color: #1d1d1f;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        .quiz-question {
            font-size: 18px;
            color: #86868b;
            margin-bottom: 16px;
            font-weight: 500;
        }

        .quiz-target {
            font-size: 64px;
            color: #1d1d1f;
            margin-bottom: 24px;
            font-weight: 600;
            letter-spacing: 2px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }

        .quiz-option {
            background: rgba(0, 0, 0, 0.02);
            border: 2px solid rgba(0, 0, 0, 0.08);
            border-radius: 16px;
            padding: 20px;
            font-size: 36px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .quiz-option:hover {
            background: rgba(0, 0, 0, 0.04);
            transform: scale(1.02);
        }

        .quiz-option:active {
            transform: scale(0.98);
        }

        .quiz-option.correct {
            background: rgba(52, 199, 89, 0.15);
            border-color: #34C759;
            color: #34C759;
        }

        .quiz-option.wrong {
            background: rgba(255, 59, 48, 0.15);
            border-color: #FF3B30;
            color: #FF3B30;
        }

        .quiz-option.disabled {
            pointer-events: none;
            opacity: 0.5;
        }

        .quiz-option-char {
            font-size: 36px;
            font-weight: 600;
        }

        .quiz-option-roma {
            font-size: 14px;
            color: #86868b;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.3s ease;
            letter-spacing: 0.5px;
        }

        .quiz-option.show-roma .quiz-option-roma {
            opacity: 1;
        }

        .quiz-option.correct .quiz-option-roma {
            color: #34C759;
        }

        .quiz-option.wrong .quiz-option-roma {
            color: #FF3B30;
        }

        /* ç½—é©¬éŸ³é€‰é¡¹æ ·å¼ï¼ˆå‡åâ†’ç½—é©¬éŸ³æ¨¡å¼ï¼‰ */
        .quiz-option.roma-option {
            padding: 24px 20px;
        }

        .quiz-option-roma-main {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 2px;
            color: #1d1d1f;
        }

        .quiz-option.roma-option.correct .quiz-option-roma-main {
            color: #34C759;
        }

        .quiz-option.roma-option.wrong .quiz-option-roma-main {
            color: #FF3B30;
        }

        /* è¾“å…¥æ¡†æ ·å¼ */
        .quiz-input-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .quiz-input {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            font-size: 32px;
            text-align: center;
            border: 3px solid rgba(0, 122, 255, 0.3);
            border-radius: 16px;
            background: rgba(0, 0, 0, 0.02);
            outline: none;
            transition: all 0.2s;
            font-weight: 600;
        }

        .quiz-input:focus {
            border-color: #007AFF;
            background: white;
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
        }

        .quiz-input.correct {
            border-color: #34C759;
            background: rgba(52, 199, 89, 0.1);
        }

        .quiz-input.wrong {
            border-color: #FF3B30;
            background: rgba(255, 59, 48, 0.1);
        }

        .quiz-input-hint {
            font-size: 14px;
            color: #86868b;
            text-align: center;
        }

        /* æ··æ·†å¯¹å†³æ¨¡å¼æç¤º */
        .confusion-candidates {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 16px;
            padding: 16px;
            background: rgba(255, 149, 0, 0.08);
            border-radius: 16px;
            border: 1px solid rgba(255, 149, 0, 0.2);
        }

        .confusion-candidate {
            font-size: 48px;
            font-weight: 600;
            color: #1d1d1f;
            padding: 8px 16px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .quiz-submit-btn {
            padding: 16px 48px;
            font-size: 18px;
            font-weight: 600;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quiz-submit-btn:hover {
            background: #0051D5;
            transform: scale(1.02);
        }

        .quiz-submit-btn:active {
            transform: scale(0.98);
        }

        .quiz-submit-btn:disabled {
            background: #86868b;
            cursor: not-allowed;
            transform: none;
        }

        /* äº¤äº’æ¨¡å¼åˆ‡æ¢ */
        .quiz-interaction-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
            background: rgba(120, 120, 128, 0.12);
            border-radius: 10px;
            padding: 3px;
        }

        .quiz-interaction-tab {
            flex: 1;
            background: transparent;
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            font-size: 14px;
            font-weight: 600;
            color: #86868b;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .quiz-interaction-tab:hover {
            color: #1d1d1f;
        }

        .quiz-interaction-tab.active {
            background: white;
            color: #1d1d1f;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        .quiz-result {
            padding: 12px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quiz-result.correct {
            background: rgba(52, 199, 89, 0.15);
            color: #34C759;
        }

        .quiz-result.wrong {
            background: rgba(255, 59, 48, 0.15);
            color: #FF3B30;
        }

        .quiz-result.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .quiz-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 16px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: 16px;
        }

        .quiz-stat {
            text-align: center;
        }

        .quiz-stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #1d1d1f;
        }

        .quiz-stat-label {
            font-size: 12px;
            color: #86868b;
            margin-top: 2px;
        }

        .quiz-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .quiz-btn {
            flex: 1;
            background: white;
            border: 2px solid rgba(0, 0, 0, 0.08);
            border-radius: 16px;
            padding: 14px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .quiz-btn:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .quiz-btn.primary {
            background: #007AFF;
            color: white;
            border-color: #007AFF;
        }

        .quiz-btn.primary:hover {
            background: #0051D5;
            border-color: #0051D5;
        }

        /* é”™é¢˜æœ¬æ ·å¼ */
        .error-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .error-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .error-item-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .error-char {
            font-size: 36px;
            font-weight: 600;
        }

        .error-info {
            text-align: left;
        }

        .error-roma {
            font-size: 16px;
            color: #86868b;
            margin-bottom: 4px;
        }

        .error-count {
            font-size: 13px;
            color: #FF3B30;
            font-weight: 600;
        }

        .error-actions {
            display: flex;
            gap: 8px;
        }

        .error-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .error-btn.review {
            background: rgba(0, 122, 255, 0.15);
            color: #007AFF;
        }

        .error-btn.remove {
            background: rgba(120, 120, 128, 0.16);
            color: #1d1d1f;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #86868b;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-text {
            font-size: 18px;
            font-weight: 500;
        }

        /* ç»Ÿè®¡é¡µé¢ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.02);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
        }

        .stat-value {
            font-size: 48px;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 15px;
            color: #86868b;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.98);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 24px 16px;
            }

            h1 {
                font-size: 2em;
            }

            .subtitle {
                font-size: 1em;
                margin-bottom: 30px;
            }

            .action-buttons {
                flex-direction: column;
                align-items: stretch;
            }

            .action-btn {
                justify-content: center;
            }

            .hiragana-grid {
                grid-template-columns: repeat(auto-fill, minmax(75px, 1fr));
                gap: 10px;
            }

            .hiragana-card {
                padding: 20px 10px;
            }

            .hiragana-char {
                font-size: 40px;
            }

            .modal-content {
                padding: 36px 24px;
                border-radius: 24px;
            }

            .modal-char {
                font-size: 72px;
            }

            .modal-roma {
                font-size: 20px;
                margin-bottom: 32px;
            }

            .quiz-target {
                font-size: 52px;
                min-height: 70px;
            }

            .quiz-input {
                font-size: 24px;
                padding: 16px;
            }

            .confusion-candidate {
                font-size: 36px;
            }

            .quiz-options {
                grid-template-columns: 1fr;
            }

            .quiz-option {
                padding: 16px;
            }

            .quiz-option-char {
                font-size: 32px;
            }

            .quiz-option-roma {
                font-size: 13px;
            }

            .quiz-stat-value {
                font-size: 24px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .footer {
            text-align: center;
            color: #86868b;
            margin-top: 60px;
            font-size: 15px;
            font-weight: 400;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ—¥è¯­äº”åéŸ³å­¦ä¹ </h1>
        <div class="subtitle" id="subtitle">å¹³å‡å Â· Hiragana Â· ä¼˜åŒ–åŠ©è®°ç‰ˆ</div>

        <!-- æ¨¡å¼åˆ‡æ¢ -->
        <div class="mode-tabs">
            <button class="mode-tab hiragana active" onclick="switchMode('hiragana')">å¹³å‡å</button>
            <button class="mode-tab katakana" onclick="switchMode('katakana')">ç‰‡å‡å</button>
        </div>

        <!-- åŠŸèƒ½æŒ‰é’® -->
        <div class="action-buttons">
            <button class="action-btn primary" onclick="startQuiz()">
                <span>éšæœºæ£€æŸ¥</span>
            </button>
            <button class="action-btn primary" onclick="startFullTest()">
                <span>å®Œæ•´æµ‹éªŒ</span>
            </button>
            <button class="action-btn" id="confusionTrainingBtn" onclick="toggleConfusionTraining()">
                <span id="confusionTrainingText">æ··æ·†è®­ç»ƒï¼šå…³é—­</span>
            </button>
            <button class="action-btn" onclick="showErrorBook()">
                <span>é”™é¢˜æœ¬</span>
                <span class="badge" id="errorBadge" style="display: none;">0</span>
            </button>
            <button class="action-btn" onclick="showStats()">
                <span>å­¦ä¹ ç»Ÿè®¡</span>
            </button>
        </div>

        <div class="hiragana-grid" id="hiraganaGrid"></div>
        <div class="footer">ç‚¹å‡»ä»»æ„å‡åæŸ¥çœ‹ä¸ºä¸­æ–‡æ¯è¯­è€…è®¾è®¡çš„è®°å¿†æŠ€å·§</div>
    </div>

    <!-- è¯¦æƒ… Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <div class="modal-char" id="modalChar"></div>
            <div class="modal-roma" id="modalRoma"></div>
            <div class="modal-section" id="modalHighlightSection" style="display: none;">
                <div class="modal-label">æ˜“æ··æ·†æç¤º</div>
                <div class="modal-text" id="modalHighlight"></div>
            </div>
            <div class="modal-section" id="modalHighlightPartsSection" style="display: none;">
                <div class="modal-label">å…³é”®ç¬”ç”»æç¤º</div>
                <div class="highlight-parts-list" id="modalHighlightParts"></div>
            </div>
            <div class="modal-section" id="modalConfusionsSection" style="display: none;">
                <div class="modal-label">æ˜“æ··æ·†å‡å</div>
                <div id="modalConfusions"></div>
            </div>
            <div class="modal-section">
                <div class="modal-label">è®°å¿†æŠ€å·§</div>
                <div class="modal-text" id="modalMemory"></div>
            </div>
            <div class="modal-section">
                <div class="modal-label">å½¢çŠ¶è§£è¯»</div>
                <div class="modal-text" id="modalShape"></div>
            </div>
        </div>
    </div>

    <!-- éšæœºæ£€æŸ¥ Modal -->
    <div class="modal-overlay" id="quizModal">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="close-btn" onclick="closeQuizModal()">&times;</button>
            <div class="quiz-container">
                <!-- äº¤äº’æ¨¡å¼åˆ‡æ¢ -->
                <div class="quiz-interaction-tabs">
                    <button class="quiz-interaction-tab active" id="quizInteractionInput" onclick="switchInteractionMode('input')">è¾“å…¥æ¨¡å¼</button>
                    <button class="quiz-interaction-tab" id="quizInteractionChoice" onclick="switchInteractionMode('choice')">é€‰æ‹©æ¨¡å¼</button>
                </div>
                <!-- å‡ºé¢˜æ¨¡å¼åˆ‡æ¢ -->
                <div class="quiz-type-tabs">
                    <button class="quiz-type-tab active" id="quizTypeKanaToRoma" onclick="switchQuizType('kana-to-roma')">å‡å â†’ ç½—é©¬éŸ³</button>
                    <button class="quiz-type-tab" id="quizTypeRomaToKana" onclick="switchQuizType('roma-to-kana')">ç½—é©¬éŸ³ â†’ å‡å</button>
                </div>
                <div class="quiz-question" id="quizModeLabel">è¯·è¾“å…¥ç½—é©¬éŸ³</div>
                <div class="quiz-progress" id="quizProgress" style="display: none; text-align: center; font-size: 14px; color: #86868b; margin-bottom: 12px;">
                    <span id="quizProgressText">ç¬¬ 1 / 46 é¢˜</span>
                </div>
                <div class="quiz-target" id="quizTarget"></div>
                <!-- è¾“å…¥æ¡†å®¹å™¨ -->
                <div class="quiz-input-container" id="quizInputContainer" style="display: flex;">
                    <input type="text" class="quiz-input" id="quizInput" placeholder="è¾“å…¥ç­”æ¡ˆ..." autocomplete="off">
                    <div class="quiz-input-hint">æŒ‰ Enter æäº¤ Â· æŒ‰ Esc è·³è¿‡</div>
                    <!-- æ··æ·†å¯¹å†³å€™é€‰å‡å -->
                    <div class="confusion-candidates" id="confusionCandidates" style="display: none;"></div>
                </div>
                <!-- é€‰æ‹©é¢˜é€‰é¡¹å®¹å™¨ -->
                <div class="quiz-options" id="quizOptions" style="display: none;"></div>
                <div class="quiz-result hidden" id="quizResult"></div>
                <div class="quiz-stats">
                    <div class="quiz-stat">
                        <div class="quiz-stat-value" id="quizCorrect">0</div>
                        <div class="quiz-stat-label">æ­£ç¡®</div>
                    </div>
                    <div class="quiz-stat">
                        <div class="quiz-stat-value" id="quizWrong">0</div>
                        <div class="quiz-stat-label">é”™è¯¯</div>
                    </div>
                    <div class="quiz-stat">
                        <div class="quiz-stat-value" id="quizAccuracy">0%</div>
                        <div class="quiz-stat-label">æ­£ç¡®ç‡</div>
                    </div>
                </div>
                <div class="quiz-actions">
                    <button class="quiz-btn" onclick="closeQuizModal()">ç»“æŸ</button>
                    <button class="quiz-btn primary" onclick="proceedToNextOrFinish()" id="nextBtn">ä¸‹ä¸€é¢˜</button>
                </div>
            </div>
        </div>
    </div>

    <!-- é”™é¢˜æœ¬ Modal -->
    <div class="modal-overlay" id="errorModal">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="close-btn" onclick="closeErrorModal()">&times;</button>
            <h2 id="errorModalTitle" style="text-align: center; margin-bottom: 24px; font-size: 28px;">é”™é¢˜æœ¬</h2>
            <div id="errorContent"></div>
            <div style="margin-top: 24px; text-align: center;">
                <button class="quiz-btn" onclick="closeErrorModal()">å…³é—­</button>
                <button class="quiz-btn" onclick="clearAllErrors()" style="background: #FF3B30; color: white; border-color: #FF3B30; margin-left: 12px;">æ¸…ç©ºé”™é¢˜æœ¬</button>
            </div>
        </div>
    </div>

    <!-- ç»Ÿè®¡ Modal -->
    <div class="modal-overlay" id="statsModal">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="close-btn" onclick="closeStatsModal()">&times;</button>
            <h2 id="statsModalTitle" style="text-align: center; margin-bottom: 24px; font-size: 28px;">å­¦ä¹ ç»Ÿè®¡</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="statTotal">0</div>
                    <div class="stat-label">æ€»æµ‹è¯•æ¬¡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statCorrect">0</div>
                    <div class="stat-label">æ­£ç¡®æ¬¡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statWrong">0</div>
                    <div class="stat-label">é”™è¯¯æ¬¡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statAccuracy">0%</div>
                    <div class="stat-label">æ€»æ­£ç¡®ç‡</div>
                </div>
            </div>
            <div style="margin-top: 24px; text-align: center;">
                <button class="quiz-btn" onclick="closeStatsModal()">å…³é—­</button>
                <button class="quiz-btn" onclick="resetStats()" style="background: #FF3B30; color: white; border-color: #FF3B30; margin-left: 12px;">é‡ç½®ç»Ÿè®¡</button>
            </div>
        </div>
    </div>

    <!-- æµ‹éªŒå®Œæˆæˆç»© Modal -->
    <div class="modal-overlay" id="resultModal">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="close-btn" onclick="closeResultModal()">&times;</button>
            <h2 style="text-align: center; margin-bottom: 12px; font-size: 32px;">ğŸ‰ æµ‹éªŒå®Œæˆï¼</h2>
            <div id="resultModalTitle" style="text-align: center; margin-bottom: 24px; font-size: 18px; color: #86868b;"></div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="resultTotal">0</div>
                    <div class="stat-label">æ€»é¢˜æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="resultCorrect" style="color: #34C759;">0</div>
                    <div class="stat-label">æ­£ç¡®</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="resultWrong" style="color: #FF3B30;">0</div>
                    <div class="stat-label">é”™è¯¯</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="resultAccuracy">0%</div>
                    <div class="stat-label">æ­£ç¡®ç‡</div>
                </div>
            </div>
            <div id="resultGrade" style="text-align: center; margin-top: 24px; font-size: 48px;"></div>
            <div id="resultComment" style="text-align: center; margin-top: 12px; font-size: 16px; color: #86868b;"></div>
            <div style="margin-top: 32px; text-align: center; display: flex; gap: 12px; justify-content: center;">
                <button class="quiz-btn primary" onclick="retakeFullTest()">å†æµ‹ä¸€æ¬¡</button>
                <button class="quiz-btn" onclick="closeResultModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        // å½“å‰æ¨¡å¼å’ŒçŠ¶æ€
        let currentMode = 'hiragana'; // 'hiragana' æˆ– 'katakana'
        let currentIndex = null;
        let confusionTrainingMode = false;
        let quizType = 'kana-to-roma'; // 'roma-to-kana' æˆ– 'kana-to-roma'
        let interactionMode = 'input'; // 'input' æˆ– 'choice'

        // æ˜“æ··æ·†å‡ååˆ—è¡¨ï¼ˆç”¨äºæ··æ·†è®­ç»ƒæ¨¡å¼ï¼‰
        const hiraganaConfusionList = ["ã­", "ã‚Œ", "ã‚", "ã•", "ã¡", "ã¾", "ã»", "ã‚‰", "ã‚", "ã‚‹", "ã‚Š"];
        const katakanaConfusionList = ["ã‚¢", "ãƒ¤", "ã‚·", "ãƒ„", "ã‚½", "ãƒ³", "ãƒ", "ã‚¯", "ãƒ¯", "ã‚¦", "ãƒ•", "ãƒ©", "ãƒª", "ãƒ«", "ãƒ¬", "ãƒ­"];

        const hiraganaData = {
            // ã‚è¡Œ
            "ã‚": {"roma": "a", "memory": "åƒä¸€ä¸ªäººå¼ å¼€åŒè‡‚å¤§å–Šã€Œå•Šã€ï¼Œå‘éŸ³å°±æ˜¯ aã€‚", "shape": "å·¦è¾¹æ˜¯èº«ä½“ï¼Œå³è¾¹ä¸¤ç¬”åƒå¼ å¼€çš„æ‰‹å’Œå˜´ã€‚"},
            "ã„": {"roma": "i", "memory": "ä¸¤æ¡ç»†çº¿æŒ¤åœ¨ä¸€èµ·ï¼Œåƒä¸¤ä¸ªå­—æ¯ i å¹¶æ’ï¼Œè¯»éŸ³å°±æ˜¯ iã€‚", "shape": "ä¸¤æ ¹ç»†é•¿ç«–çº¿å¹¶æ’ç«™ç€ã€‚"},
            "ã†": {"roma": "u", "memory": "åƒå˜´å·´å¾€ä¸‹å‡¹ç€åœ¨ã€Œå‘œå‘œã€åœ°å«ï¼Œå‘éŸ³ u å¾ˆè´´è„¸ã€‚", "shape": "ä¸€çŸ­æ¨ªåœ¨ä¸Šï¼Œä¸€æ¡å¼¯çº¿åƒé¸Ÿå˜´å¾€ä¸‹æˆ³ã€‚"},
            "ãˆ": {"roma": "e", "memory": "ä¸Šé¢åƒä¸‰å‰å±•å¼€ï¼Œè¯´ã€Œè¯¶ã€çš„æ—¶å€™ä¸¤æ‰‹æ‘Šå¼€æ¯”åˆ’çš„æ„Ÿè§‰ã€‚", "shape": "ä¸Šæ–¹åˆ†å‰ï¼Œä¸‹é¢æ”¶æ‹¢æˆä¸€ç¬”ã€‚"},
            "ãŠ": {"roma": "o", "memory": "åœ¨ã€Œã‚ã€çš„åŸºç¡€ä¸Šå¤šç»•ä¸€åœˆï¼Œå°±åƒä»ã€Œå•Šã€æ”¶æˆåœ†å£çš„ oã€‚", "shape": "å·¦è¾¹ç«–çº¿ï¼Œå³è¾¹ä¸€å¤§åœˆæ”¶å›å»ã€‚"},

            // ã‹è¡Œ
            "ã‹": {"roma": "ka", "memory": "å·¦è¾¹åƒæ±‰å­—ã€ŒåŠ›ã€çš„ç®€å†™ï¼Œè”æƒ³åˆ°ç”¨åŠ›ã€Œå¡ä½ã€çš„ kaã€‚", "shape": "ä¸€ç«–ä¸€å°å‹¾åƒåŠ›å­—ï¼Œå³è¾¹ä¼¸å‡ºä¸€æ¨ªä¸€æ’‡ã€‚"},
            "ã": {"roma": "ki", "memory": "æ•´å½¢åƒä¸€æŠŠé’¥åŒ™ keyï¼Œå‘éŸ³ kiï¼Œé’¥åŒ™å¸®ä½ ã€Œå¼€å¯ã€æ—¥è¯­ã€‚", "shape": "ä¸‰æ¡çŸ­æ¨ªå åœ¨ç«–çº¿ä¸Šï¼Œåƒé’¥åŒ™çš„é½¿ã€‚"},
            "ã": {"roma": "ku", "memory": "åƒå˜´è§’ä¸‹æ’‡åœ¨ã€Œå“­ï¼ˆkuï¼‰ã€çš„æ ·å­ï¼Œä¸€å¼¯æ•´æ®µã€‚", "shape": "ç®€å•çš„ä¸€ç¬”å¼¯é’©ï¼Œå¼ å¼€çš„å˜´è§’ã€‚"},
            "ã‘": {"roma": "ke", "memory": "åƒä¸€æ‰‡ç«‹ç€çš„é—¨ï¼Œå³è¾¹é‚£ä¸€æ’‡åƒé—¨æŠŠæ‰‹ï¼Œã€Œå¼€ keã€é—¨çš„æ„Ÿè§‰ã€‚", "shape": "å·¦ç«–ä¸ºé—¨æ¡†ï¼Œå³è¾¹ä¸€æ¨ªä¸€æ–œåƒé—¨æŠŠã€‚"},
            "ã“": {"roma": "ko", "memory": "ä¸¤æ¡æ¨ªçº¿å åœ¨ä¸€èµ·ï¼Œåƒ co-co ä¸¤ä¸ªéŸ³æ’é˜Ÿï¼Œè¯» koã€‚", "shape": "éå¸¸è§„æ•´çš„ä¸Šä¸‹ä¸¤æ¡çŸ­æ¨ªã€‚"},

            // ã•è¡Œ
            "ã•": {
                "roma": "sa",
                "memory": "åƒä»ä¸Šå¾€ä¸‹æ’’ä¸œè¥¿çš„åŠ¨ä½œï¼Œã€Œæ’’ã€å’Œ sa å‘éŸ³æ¥è¿‘ã€‚",
                "shape": "é¡¶ä¸Šä¸€æ¨ªï¼Œä¸‹é¢ä¸€é•¿å¼§åƒæ’’è½çš„è½¨è¿¹ã€‚",
                "highlightParts": ["å‘ä¸‹æ’’è½çš„å¤§å¼§"],
                "confusions": [
                    {"char": "ã¡", "reason": "ã¡ åƒå†™å¼¯çš„æ•°å­—5ï¼Œè€Œ ã• çš„å¼§çº¿åƒåœ¨'æ’’'ä¸‹å»ï¼Œå…³é”®å·®å¼‚ï¼šå½¢çŠ¶å¼¯æ›²æ–¹å‘ä¸åŒ"}
                ]
            },
            "ã—": {"roma": "shi", "memory": "åƒä¸€æ ¹æ’è¿›æ¯å­é‡Œçš„å¸ç®¡ï¼Œã€Œå¸ï¼ˆxÄ«ï¼‰ã€å£å‹ä¸€å˜å°±æ˜¯æ—¥è¯­çš„ shiã€‚", "shape": "ä»ä¸Šåˆ°ä¸‹çš„å¼¯çº¿ï¼Œåƒç›´ç›´æ’ä¸‹å»ç•¥å¾®å¼¯æ›²çš„å¸ç®¡ã€‚"},
            "ã™": {"roma": "su", "memory": "çº¿æ¡æ‰­æˆä¸€åœˆå†å‹¾å‡ºå»ï¼Œåƒå†™å¾—å¾ˆå¿«çš„ã€Œé€Ÿã€çš„ä¸€ç¬”ï¼Œè”æƒ³ã€Œé€Ÿåº¦ suã€ã€‚", "shape": "é¡¶ä¸Šä¸€ç‚¹ï¼Œä¸‹é¢å¼¯æˆåœˆå†ç”©å‡ºå°¾å·´ã€‚"},
            "ã›": {"roma": "se", "memory": "æ•´ä½“å¾ˆåƒæ±‰å­—ã€Œä¸–ã€çš„è‰å†™ç‰ˆï¼Œæ—¥è¯­ã€Œä¸–ç•Œã€è¯» ã›ã‹ã„ã€‚", "shape": "ä¸Šæ¨ªä¸‹æ¨ªï¼Œä¸­é—´ç«–é’©è¿åœ¨ä¸€èµ·ã€‚"},
            "ã": {"roma": "so", "memory": "åƒç¼è¡£æœæ—¶çš„é’ˆçº¿é’©ä½å¸ƒï¼Œã€Œæœ soã€ç€æŠŠçº¿å¸¦è¿‡å»ã€‚", "shape": "ä¸€ç¬”ç”»å‡ºçš„å¼¯é’©ï¼Œå°¾å·´å‘ä¸ŠæŒ‘ã€‚"},

            // ãŸè¡Œ
            "ãŸ": {"roma": "ta", "memory": "é¡¶éƒ¨åƒå­—æ¯ t çš„æ¨ªå’Œç«–ï¼Œè¯» taï¼Œè”æƒ³ã€Œä»– taã€è¿™ä¸ªéŸ³ã€‚", "shape": "ä¸Šæ¨ªåŠ ç«–ï¼Œå†æ·»å³ä¸‹çš„ä¸€æ’‡ã€‚"},
            "ã¡": {
                "roma": "chi",
                "memory": "åƒå†™å¼¯äº†çš„æ•°å­— 5ï¼Œè®°æˆã€Œ5 åƒ chi æ‰äº†å¤´ã€ã€‚",
                "shape": "ä¸€åœˆä¸€å¼¯ï¼Œæ•´ä½“åƒä¸ªæ‰­æ›²çš„ 5ã€‚",
                "highlightParts": ["æ•°å­—5å‹å¼¯æ›²"],
                "confusions": [
                    {"char": "ã•", "reason": "ã• çš„å¼§çº¿åƒåœ¨'æ’’'ä¸‹å»ï¼Œè€Œ ã¡ åƒå†™å¼¯çš„æ•°å­—5ï¼Œå…³é”®å·®å¼‚ï¼šå½¢çŠ¶å¼¯æ›²æ–¹å‘ä¸åŒ"}
                ]
            },
            "ã¤": {"roma": "tsu", "memory": "åƒä¸‰æ»´æ°´å¾€ä¸‹æ‰çš„è½¨è¿¹ï¼Œæƒ³è±¡æ°´è½ä¸‹æ—¶å‘ã€Œæ»‹ tsuã€çš„ä¸€å£°ã€‚", "shape": "ä¸‰æ¡çŸ­çº¿æ’æˆå¼§å½¢å‘ä¸‹å€¾æ–œã€‚"},
            "ã¦": {"roma": "te", "memory": "æ—¥è¯­é‡Œã€Œæ‰‹ã€å°±è¯» ã¦ï¼Œå½¢çŠ¶åƒä¼¸å‡ºå»çš„ä¸€åªæ‰‹ã€‚", "shape": "ä¸€æ¡å¼¯çº¿ä¼¸å‘å³è¾¹ï¼Œå†æ¥ä¸€æ¡çŸ­æ¨ªåƒæ‰‹æŒã€‚"},
            "ã¨": {"roma": "to", "memory": "åƒä¸€æ ¹é’‰å­æˆ–å°–åˆ€æˆ³è¿›ä¸œè¥¿é‡Œï¼Œè®©äººå–Šä¸€å£°ã€Œç—› toã€ã€‚", "shape": "å·¦è¾¹ä¸€å°æ’‡ï¼Œå³è¾¹ä¸€é•¿é’©å‘ä¸‹æ‰ã€‚"},

            // ãªè¡Œ
            "ãª": {"roma": "na", "memory": "åƒå…ˆç”»åå­—å†å¾€ä¸‹ç»•ä¸€åœˆï¼Œåƒä¼¸æ‰‹å»ã€Œæ‹¿ naã€ä¸œè¥¿çš„åŠ¨ä½œã€‚", "shape": "ä¸Šéƒ¨åå­—ï¼Œä¸‹é¢å¼¯çº¿ç»•å›å·¦è¾¹ã€‚"},
            "ã«": {"roma": "ni", "memory": "å‡ ä¹å°±æ˜¯æ±‰å­—ã€ŒäºŒã€çš„æ‰‹å†™ä½“ï¼Œæ—¥è¯­é‡Œã€ŒäºŒã€ä¹Ÿè¯» ã«ï¼ˆniï¼‰ã€‚", "shape": "ä¸¤æ¡å¹³è¡Œçš„çŸ­æ¨ªçº¿ã€‚"},
            "ã¬": {"roma": "nu", "memory": "ä¸‹æ–¹åœˆåœˆåƒæ‰“ç»“çš„é¢æ¡ï¼Œè”æƒ³ã€Œæ‰­æ¥æ‰­å»ã€çš„ã¬ã€‚", "shape": "ä¸Šé¢ä¸€ç‚¹ä¸€ç¬”ï¼Œä¸‹æ–¹ä¸€åœˆç»•æˆç»“ã€‚", "highlight": "æ˜“æ··æ·†æç¤ºï¼šã¬ å¸¸è¢«è¯¯è®¤ä¸º ã‚ã€‚è¯†åˆ«é”šç‚¹ï¼šã¬ æœ‰'åœˆ + å³å‹¾'ï¼Œåƒæ‰­ç»“çš„é¢æ¡ï¼ˆæ‰­â†’nuï¼‰ã€‚"},
            "ã­": {
                "roma": "ne",
                "memory": "å³è¾¹åƒç«–èµ·æ¥çš„çŒ«è€³æœµï¼Œã€ŒçŒ«ã€æ—¥è¯­è¯» ã­ã“ï¼ˆnekoï¼‰ã€‚",
                "shape": "å·¦ç«–åŠ æ¨ªï¼Œå³è¾¹ä¸€æ ¹ç«–çº¿é¡¶ç€ä¸€ä¸ªå°åœˆã€‚",
                "highlightParts": ["å³ä¸Šå°åœˆ"],
                "confusions": [
                    {"char": "ã‚Œ", "reason": "ã‚Œ çš„å³ä¾§æ˜¯ç«–çº¿+å°æ¨ªï¼Œè€Œ ã­ çš„å³ä¾§æ˜¯ç«–çº¿+åœˆï¼Œå…³é”®å·®å¼‚ï¼šã­ æœ‰åœˆï¼Œã‚Œ æ— åœˆ"},
                    {"char": "ã‚", "reason": "ã‚ å³è¾¹æ˜¯å¼¯é’©ï¼Œã­ å³è¾¹æ˜¯ç«–çº¿+åœˆï¼Œå…³é”®å·®å¼‚ï¼šå‹¾ vs åœˆ"}
                ]
            },
            "ã®": {"roma": "no", "memory": "å°±æ˜¯ä¸€ä¸ªé¡ºæ‰‹ç”»å‡ºæ¥çš„åœˆï¼Œåƒå†™è‹±æ–‡ no æ—¶æœ€åçš„ oã€‚", "shape": "ä¸€ç¬”ç”»å‡ºçš„æ¤­åœ†åœˆã€‚"},

            // ã¯è¡Œ
            "ã¯": {"roma": "ha", "memory": "å·¦è¾¹åƒæ——æ†ï¼Œå³è¾¹åƒè¿é£å±•å¼€çš„å°æ——ï¼Œæ’æ——æ—¶å¤§å–Šä¸€å£°ã€Œå“ˆ haã€ã€‚", "shape": "ä¸€ç«–ä¸€æ¨ªåšæ——æ†ï¼Œå³ä¾§å¼¯ç¬”æ˜¯æ——é¢ã€‚"},
            "ã²": {"roma": "hi", "memory": "åƒäººå¼¯ç€è…°åœ¨å·ç¬‘ï¼Œå‘ã€Œå˜»/hiã€çš„æ°”éŸ³ã€‚", "shape": "ä¸€æ¡å¼¯æ›²çº¿ä»å·¦ä¸Šæ»‘å‘å³ä¸‹ã€‚"},
            "ãµ": {"roma": "fu", "memory": "ä¸­é—´ä¸¤ç‚¹å’Œå¼§çº¿åƒä¸€åº§å°å±±ï¼Œè”æƒ³å¯Œå£«å±±ã€Œãµã˜ã•ã‚“ã€ã€‚", "shape": "ä¸­é—´ä¸€ç«–ä¸¤ç‚¹ï¼Œä¸‹æ–¹ä¸€æ¡å¤§å¼§ã€‚"},
            "ã¸": {"roma": "he", "memory": "å°±æ˜¯ä¸€ä¸ªå°å±±å¡ï¼Œå¾€ä¸Šçˆ¬æ—¶ä¼šã€Œå˜¿ heã€åœ°å–˜æ°”ã€‚", "shape": "ä¸€ä¸ªç®€å•çš„å€’ V å½¢ã€‚"},
            "ã»": {
                "roma": "ho",
                "memory": "å·¦è¾¹åƒä¸€æ ¹æŸ±å­ï¼Œå³è¾¹åƒå¸¦çª—çš„å°æˆ¿å­ï¼Œhouse çš„ hoã€‚",
                "shape": "ç«–çº¿æ—è¾¹åŠ åå­—å’ŒçŸ­æ¨ªï¼Œåƒæˆ¿å­ç»“æ„ã€‚",
                "highlightParts": ["å·¦ç«–+ä¸­å¿ƒåå­—"],
                "confusions": [
                    {"char": "ã¾", "reason": "ã¾ å·¦ä¾§æ˜¯æ³¢æµªï¼Œè€Œ ã» æœ‰å·¦ç«–+ä¸­å¿ƒåå­—ï¼ˆåƒçª—å£ï¼‰ï¼Œå…³é”®å·®å¼‚ï¼šåå­—å›ºå®šå±äº ã»"}
                ]
            },

            // ã¾è¡Œ
            "ã¾": {
                "roma": "ma",
                "memory": "æ•´ä½“åƒå†™å´©çš„ã€Œé©¬ã€å­—ï¼Œå‘éŸ³ä¹Ÿæ˜¯ maã€‚",
                "shape": "ä»ä¸Šå¾€ä¸‹å¼¯å¼¯æ›²æ›²ï¼Œæœ‰ä¸‰ä¸ªå°å³°ã€‚",
                "highlightParts": ["ä¸‰ä¸ªæ³¢æµªå³°"],
                "confusions": [
                    {"char": "ã»", "reason": "ã» æœ‰å·¦ç«–+ä¸­å¿ƒåå­—ï¼ˆåƒçª—å£ï¼‰ï¼Œè€Œ ã¾ å·¦ä¾§æ˜¯æ³¢æµªä¸æ˜¯åå­—ï¼Œå…³é”®å·®å¼‚ï¼šåå­—å›ºå®šå±äº ã»"}
                ]
            },
            "ã¿": {"roma": "mi", "memory": "ä¸‰æ®µå°å¼¯åƒä¸‰æ¡æ³¢æµªï¼Œè”æƒ³ä¸€æŠŠã€Œç±³ miã€æ´’æˆä¸‰æ¡çº¿ã€‚", "shape": "ä¸‰ç¬”ä¾æ¬¡å‘å³ä¸‹å¼¯ã€‚"},
            "ã‚€": {"roma": "mu", "memory": "åƒä¸€åªèœ—ç‰›çš„å£³åœ¨å¾€ä¸Šå·ï¼Œæ…¢æ…¢åœ°ã€ŒæŒª muã€åŠ¨ã€‚", "shape": "ä¸ŠåŠéƒ¨åˆ†æˆåœˆï¼Œå°¾å·´å‘å·¦ä¼¸ã€‚"},
            "ã‚": {"roma": "me", "memory": "åƒä¸€åªé—­ç€çš„çœ¼ç›ï¼Œæ—¥è¯­ã€Œç›®ã€å°±è¯» ã‚ï¼ˆmeï¼‰ã€‚", "shape": "ä¸€æ¡å¼¯çº¿é…ä¸€ä¸ªå°é’©ï¼Œå½¢ä¼¼çœ¼ç›è½®å»“ã€‚", "highlight": "æ˜“æ··æ·†æç¤ºï¼šã‚ å¸¸è¢«è¯¯è®¤ä¸º ã¬ã€‚è¯†åˆ«é”šç‚¹ï¼šã‚ ä¸ç»•åœˆï¼Œå·¦ä¾§è£‚å¼€ï¼Œåƒ'ç›®ï¼ˆmeï¼‰'ã€‚"},
            "ã‚‚": {"roma": "mo", "memory": "ä¸‰æ¡æ¨ªçº¿å åŠ ï¼Œåƒä¸‰æ ¹ã€Œæ¯› moã€ç«–åœ¨ä¸€èµ·ã€‚", "shape": "ä¸Šä¸­ä¸‹ä¸‰æ¨ªå³ä¾§è¿ç€ç«–å¼¯ã€‚"},

            // ã‚„è¡Œ
            "ã‚„": {"roma": "ya", "memory": "åƒå²”å¼€çš„æ ‘æï¼Œä¸­æ–‡ã€Œä¸«ã€å’Œ ya åŒéŸ³ã€‚", "shape": "ä¸Šä¸‹ä¸€ç«–ï¼Œä¸­é—´å²”å‡ºä¸€æ’‡ã€‚"},
            "ã‚†": {"roma": "yu", "memory": "å¤–é¢åƒä¸€ä¸ªæ–¹æ¡†æµ´ç¼¸ï¼Œé‡Œé¢ä¸€ç¬”åƒæ°´é¢ï¼Œè”æƒ³ã€Œæµ´ yuã€ã€‚", "shape": "çŸ©å½¢è½®å»“é‡ŒåŒ…ç€ä¸€å°å‹¾ã€‚"},
            "ã‚ˆ": {"roma": "yo", "memory": "ä¸‰æ®µç»“æ„åƒä¸Šä¸‹ç‰™é½¿åŠ ä¸‹å·´ï¼Œå¼ å˜´å–Šã€Œå“Ÿ yoã€ã€‚", "shape": "ä¸Šé¢ä¸¤çŸ­æ¨ªï¼Œä¸‹é¢ä¸€å¼¯é’©æ‰˜ä½ã€‚"},

            // ã‚‰è¡Œ
            "ã‚‰": {
                "roma": "ra",
                "memory": "åƒä¸€æ ¹è¢«æ‹‰èµ·æ¥çš„ç»³å°¾ï¼Œè”æƒ³ã€Œæ‹‰ raã€ã€‚",
                "shape": "ä»ä¸Šå¾€ä¸‹å¼¯æŠ˜åƒç”©èµ·æ¥çš„çº¿ã€‚",
                "highlightParts": ["å•å¼§çº¿"],
                "confusions": [
                    {"char": "ã‚", "reason": "ã‚ æ˜¯æœªå°å£çš„å£å½¢ï¼ˆä¸‰è¾¹æ¡†ï¼‰ï¼Œè€Œ ã‚‰ æ˜¯å•å¼§çº¿ï¼Œå…³é”®å·®å¼‚ï¼šæ¡† vs å¼§"},
                    {"char": "ã‚‹", "reason": "ã‚‹ æœ‰å°åœˆ+å°¾å·´ï¼Œè€Œ ã‚‰ æ˜¯å•å¼§çº¿æ— åœˆï¼Œå…³é”®å·®å¼‚ï¼šæœ‰åœˆ vs æ— åœˆ"},
                    {"char": "ã‚Š", "reason": "ã‚Š æ˜¯åŒç«–çº¿ï¼Œè€Œ ã‚‰ æ˜¯å•å¼§çº¿ï¼Œå…³é”®å·®å¼‚ï¼šç›´ vs å¼¯"}
                ]
            },
            "ã‚Š": {
                "roma": "ri",
                "memory": "ä¸¤æ ¹å°å‹¾å¹¶æ’ï¼Œåƒä¸¤æ ¹ç­·å­ç«‹ç€ï¼Œè¯» riã€‚",
                "shape": "å·¦çŸ­å³é•¿çš„ä¸¤æ¡ç«–å¼¯çº¿ã€‚",
                "highlightParts": ["ä¸¤æ¡ç«–çº¿"],
                "confusions": [
                    {"char": "ã‚‰", "reason": "ã‚‰ æ˜¯å•å¼§çº¿ï¼Œè€Œ ã‚Š æ˜¯åŒç«–çº¿ï¼Œå…³é”®å·®å¼‚ï¼šå¼¯ vs ç›´"},
                    {"char": "ã‚", "reason": "ã‚ æ˜¯æœªå°å£çš„å£å½¢ï¼ˆä¸‰è¾¹æ¡†ï¼‰ï¼Œè€Œ ã‚Š æ˜¯åŒç«–çº¿ï¼Œå…³é”®å·®å¼‚ï¼šæ¡† vs çº¿"},
                    {"char": "ã‚‹", "reason": "ã‚‹ æœ‰å°åœˆ+å°¾å·´ï¼Œè€Œ ã‚Š æ˜¯åŒç«–çº¿æ— åœˆï¼Œå…³é”®å·®å¼‚ï¼šæœ‰åœˆ vs æ— åœˆ"}
                ]
            },
            "ã‚‹": {
                "roma": "ru",
                "memory": "å°¾å·´å·æˆä¸€åœˆï¼Œåƒè·¯ä¸Šæ‰“çš„å°æ¼©æ¶¡ï¼Œè”æƒ³ã€Œç»•æ¥ç»•å» ruã€ã€‚",
                "shape": "ä¸ŠåŠåœˆï¼Œä¸‹æ–¹ä¸€å°å°¾å·´å‘å³ç”©ã€‚",
                "highlightParts": ["å°åœˆ+å³ç”©å°¾å·´"],
                "confusions": [
                    {"char": "ã‚‰", "reason": "ã‚‰ æ˜¯å•å¼§çº¿æ— åœˆï¼Œè€Œ ã‚‹ æœ‰å°åœˆ+å°¾å·´ï¼Œå…³é”®å·®å¼‚ï¼šæ— åœˆ vs æœ‰åœˆ"},
                    {"char": "ã‚", "reason": "ã‚ æ˜¯æœªå°å£çš„å£å½¢ï¼ˆä¸‰è¾¹æ¡†ï¼‰ï¼Œè€Œ ã‚‹ æœ‰å°åœˆ+å°¾å·´ï¼Œå…³é”®å·®å¼‚ï¼šæ–¹æ¡† vs åœ†åœˆ"},
                    {"char": "ã‚Š", "reason": "ã‚Š æ˜¯åŒç«–çº¿æ— åœˆï¼Œè€Œ ã‚‹ æœ‰å°åœˆ+å°¾å·´ï¼Œå…³é”®å·®å¼‚ï¼šæ— åœˆ vs æœ‰åœˆ"}
                ]
            },
            "ã‚Œ": {
                "roma": "re",
                "memory": "åƒä¸€æ¡ä¸»çº¿å³ä¾§å†ä¼¸å‡ºä¸€ç¬”ï¼Œåƒè£‚å¼€çš„ä¸€é“å£ï¼Œre = è£‚ã€‚",
                "shape": "ä¸€æ¡ç«–å¼¯çº¿ï¼Œå³ä¸­éƒ¨ä¼¸å‡ºä¸€å°æ¨ªã€‚",
                "highlightParts": ["å³ä¾§å°æ¨ª"],
                "confusions": [
                    {"char": "ã­", "reason": "ã­ çš„å³ä¾§æ˜¯ç«–çº¿+åœˆï¼Œè€Œ ã‚Œ çš„å³ä¾§æ˜¯ç«–çº¿+å°æ¨ªï¼Œå…³é”®å·®å¼‚ï¼šã­ æœ‰åœˆï¼Œã‚Œ æ— åœˆ"},
                    {"char": "ã‚", "reason": "ã‚ å³è¾¹æ˜¯å¼¯é’©ï¼Œã‚Œ å³è¾¹æ˜¯ç«–çº¿+å°æ¨ªï¼Œå…³é”®å·®å¼‚ï¼šå‹¾ vs æ¨ª"}
                ]
            },
            "ã‚": {
                "roma": "ro",
                "memory": "åƒä¸€ä¸ªæ²¡å°å£çš„ã€Œå£ã€ï¼Œè¯» roï¼Œè”æƒ³ã€Œå£ã€æ¼äº†ä¸€å—ã€‚",
                "shape": "ä¸‰è¾¹æ¡†æˆ ã„‡ å½¢ï¼Œåº•éƒ¨æ•å¼€ã€‚",
                "highlightParts": ["ä¸‰è¾¹æœªå°å£æ¡†"],
                "confusions": [
                    {"char": "ã‚‰", "reason": "ã‚‰ æ˜¯å•å¼§çº¿ï¼Œè€Œ ã‚ æ˜¯æœªå°å£çš„å£å½¢ï¼ˆä¸‰è¾¹æ¡†ï¼‰ï¼Œå…³é”®å·®å¼‚ï¼šå¼§ vs æ¡†"},
                    {"char": "ã‚‹", "reason": "ã‚‹ æœ‰å°åœˆ+å°¾å·´ï¼Œè€Œ ã‚ æ˜¯æœªå°å£çš„å£å½¢ï¼ˆä¸‰è¾¹æ¡†ï¼‰ï¼Œå…³é”®å·®å¼‚ï¼šåœ†åœˆ vs æ–¹æ¡†"},
                    {"char": "ã‚Š", "reason": "ã‚Š æ˜¯åŒç«–çº¿ï¼Œè€Œ ã‚ æ˜¯æœªå°å£çš„å£å½¢ï¼ˆä¸‰è¾¹æ¡†ï¼‰ï¼Œå…³é”®å·®å¼‚ï¼šçº¿ vs æ¡†"}
                ]
            },

            // ã‚è¡Œ
            "ã‚": {
                "roma": "wa",
                "memory": "ä¸‹åŠéƒ¨åˆ†åƒå¼¯é’©ï¼Œåƒåœ¨ç”»ä¸€ä¸ªé—®å·çš„ååŠæ®µï¼Œè”æƒ³ã€Œå“‡ waã€çš„è¯­æ°”ã€‚",
                "shape": "å·¦ç«–å³å¼¯é’©ï¼Œæ•´ä½“åç˜¦ã€‚",
                "highlightParts": ["å³è¾¹å¼¯é’©"],
                "confusions": [
                    {"char": "ã‚Œ", "reason": "ã‚Œ å³è¾¹æ˜¯ç«–çº¿+å°æ¨ªï¼Œè€Œ ã‚ å³è¾¹æ˜¯å¼¯é’©ï¼Œå…³é”®å·®å¼‚ï¼šæ¨ª vs å‹¾"},
                    {"char": "ã­", "reason": "ã­ å³è¾¹æ˜¯ç«–çº¿+åœˆï¼Œè€Œ ã‚ å³è¾¹æ˜¯å¼¯é’©ï¼Œå…³é”®å·®å¼‚ï¼šåœˆ vs å‹¾"}
                ]
            },
            "ã‚’": {"roma": "wo", "memory": "åƒåŠ äº†å°¾å·´çš„ã€Œã®ã€ï¼Œæ˜¯ç‰¹æ®Šç”¨æ³•çš„ã€Œo/woã€ï¼Œè®°æˆã€Œå¸¦å°¾å·´çš„ oã€ã€‚", "shape": "ä¸€ç¬”ç”»å‡ºï¼Œå…ˆå¼¯å†åœˆï¼Œå³è¾¹å¤šå‡ºä¸€ä¸ªé’©ã€‚"},
            "ã‚“": {"roma": "n", "memory": "åƒéšæ‰‹å†™çš„ nï¼Œå‘éŸ³ä¹Ÿæ˜¯é¼»éŸ³ nã€‚", "shape": "ä»å·¦åˆ°å³æ‹‰å‡ºçš„å¼¯çº¿ï¼Œå°¾éƒ¨ç•¥å¾®ä¸ŠæŒ‘ã€‚"}
        };

        // å¹³å‡åäº”åéŸ³é¡ºåº
        const hiraganaOrder = [
            "ã‚", "ã„", "ã†", "ãˆ", "ãŠ",
            "ã‹", "ã", "ã", "ã‘", "ã“",
            "ã•", "ã—", "ã™", "ã›", "ã",
            "ãŸ", "ã¡", "ã¤", "ã¦", "ã¨",
            "ãª", "ã«", "ã¬", "ã­", "ã®",
            "ã¯", "ã²", "ãµ", "ã¸", "ã»",
            "ã¾", "ã¿", "ã‚€", "ã‚", "ã‚‚",
            "ã‚„", "ã‚†", "ã‚ˆ",
            "ã‚‰", "ã‚Š", "ã‚‹", "ã‚Œ", "ã‚",
            "ã‚", "ã‚’", "ã‚“"
        ];

        // ç‰‡å‡åæ•°æ®
        const katakanaData = {
            // ã‚¢è¡Œ
            "ã‚¢": {"roma": "a", "memory": "åƒä¸€ä¸ªäººæŠ¬å¤´å¤§å–Šã€Œå•Šã€çš„å§¿åŠ¿ï¼Œä¸å¹³å‡åçš„ã‚å¯¹åº”ã€‚", "shape": "å·¦ç«– + å³ä¸Šæ–œçº¿ï¼Œåƒå¼ å¼€æ‰‹è‡‚ã€‚"},
            "ã‚¤": {"roma": "i", "memory": "ä¸¤æ¡ç»†çº¿å¹¶æ’ï¼Œå°±æ˜¯ç›´æŒºæŒºçš„ iã€‚", "shape": "ä¸¤ç¬”ç«–çº¿ï¼Œç®€å•ç›´æ¥ã€‚"},
            "ã‚¦": {"roma": "u", "memory": "é¡¶ä¸Šåƒä¹Œé¸¦çš„å˜´ï¼Œuâ†’ä¹Œï¼Œå˜´å·´å‘å‰ä¼¸ã€‚", "shape": "ä¸€ä¸ªç«–é’©é…å¼¯æŠ˜çš„çŸ­æ¨ªã€‚"},
            "ã‚¨": {"roma": "e", "memory": "ä¸‰å±‚ç»“æ„åƒä¸‰é“æ¨ªçº¿çš„ Eã€‚", "shape": "ä¸Šä¸­ä¸‹ä¸‰æ¨ªæ˜ç¡®åˆ†å±‚ã€‚"},
            "ã‚ª": {"roma": "o", "memory": "ä¸Šé¢åƒã€Œfã€çš„ç¬”ç”»ï¼Œè¯» oï¼Œåƒåœ¨ç‚¹å¤´çš„å½¢çŠ¶ã€‚", "shape": "å·¦ç«– + å³ä¾§æ–œå‹¾ã€‚"},

            // ã‚«è¡Œ
            "ã‚«": {"roma": "ka", "memory": "å¾ˆåƒæ±‰å­—ã€ŒåŠ›ã€çš„ç®€å†™ï¼Œkaâ†’å¡ä½ã€‚", "shape": "ä¸Šæ–œçº¿ + ä¸‹ç«–çº¿ã€‚"},
            "ã‚­": {"roma": "ki", "memory": "ä¸‰æ¨ªä¸€ç«–æ˜¯å¹³å‡åãçš„ç›´çº¿ç‰ˆæœ¬ï¼Œåƒæœºæ¢°é”®ç›˜çš„ã€Œkeyã€ã€‚", "shape": "ä¸‰æ¡çŸ­æ¨ª + ä¸€ç«–ã€‚"},
            "ã‚¯": {"roma": "ku", "memory": "åƒä¸€ä¸ªå¼ å˜´çš„è§’ï¼Œè¯´ã€Œå“­ kuã€å˜´è§’ä¸‹æ’‡ã€‚", "shape": "å•å‹¾å‘å³ã€‚"},
            "ã‚±": {"roma": "ke", "memory": "åƒä¸€æ‰‡é—¨ï¼Œkeâ†’å¼€ï¼ˆkaiï¼‰ï¼Œé—¨çš„å½¢çŠ¶ã€‚", "shape": "ç«– + ä¸¤æ¨ªã€‚"},
            "ã‚³": {"roma": "ko", "memory": "ä¸¤æ¡æ¨ªçº¿æ•´é½æ’åˆ—ï¼Œkoâ†’å£å­—ç¼ºä¸€è¾¹ã€‚", "shape": "å¹³è¡Œä¸¤æ¨ªã€‚"},

            // ã‚µè¡Œ
            "ã‚µ": {"roma": "sa", "memory": "å·¦ä¾§ç«–ï¼Œå³ä¸Šä¸¤ç¬”åƒã€Œæ’’ã€å‡ºå»çš„åŠ¨ä½œã€‚", "shape": "ä¸€ç«– + ä¸¤çŸ­æ¨ªã€‚"},
            "ã‚·": {
                "roma": "shi",
                "memory": "ä¸‰ç¬”ä»å³å¾€å·¦åƒçœ¼æ³ªæ»‘ä¸‹æ¥ï¼Œshiâ†’å¸å¸å“­çš„å£°éŸ³ã€‚",
                "shape": "ä¸‰ç‚¹ä»ä¸Šåˆ°ä¸‹å€¾æ–œã€‚",
                "highlightParts": ["ä¸‰ç‚¹ç«–å‘æ’åˆ—"],
                "confusions": [
                    {"char": "ãƒ„", "reason": "ãƒ„ çš„ä¸‰ç‚¹æ˜¯æ¨ªå‘æ’åˆ—ï¼Œè€Œ ã‚· çš„ä¸‰ç‚¹æ˜¯ç«–å‘æ’åˆ—ï¼Œå…³é”®å·®å¼‚ï¼šæ¨ª vs ç«–"}
                ]
            },
            "ã‚¹": {"roma": "su", "memory": "åƒé’“é±¼é’©é’“ä¸Šæ¥ï¼ˆsuâ†’æï¼‰çš„åŠ¨ä½œã€‚", "shape": "ä¸€æ¨ª + å¼¯é’©ã€‚"},
            "ã‚»": {"roma": "se", "memory": "åƒå¹³å‡åã›çš„ç›´è§’ç‰ˆã€‚", "shape": "ä¸€ç«– + ä¸¤æ¨ªã€‚"},
            "ã‚½": {
                "roma": "so",
                "memory": "ä¸¤ç¬”åƒå‰ªåˆ€æ‰“å¼€ï¼ˆsoâ†’ã€Œå—¦ã€ä¸€ä¸‹å‰ªæ‰ï¼‰ã€‚",
                "shape": "ä¸¤æ–œçº¿å‘ˆé”è§’ã€‚",
                "highlightParts": ["ä¸¤ç‚¹å‘å³ä¸‹å€¾æ–œ"],
                "confusions": [
                    {"char": "ãƒ³", "reason": "ãƒ³ çš„ä¸¤ç‚¹å‘å·¦ä¸‹å€¾æ–œï¼Œè€Œ ã‚½ çš„ä¸¤ç‚¹å‘å³ä¸‹å€¾æ–œï¼Œå…³é”®å·®å¼‚ï¼šæ–¹å‘ç›¸å"}
                ]
            },

            // ã‚¿è¡Œ
            "ã‚¿": {"roma": "ta", "memory": "åƒ T å­—å€’ç½®ï¼Œè¯» taã€‚", "shape": "é¡¶æ¨ª + ç«– + ä¸‹çŸ­æ¨ªã€‚"},
            "ãƒ": {"roma": "chi", "memory": "ä¸Šé¢æ°´å¹³çº¿åƒæ•°å­— 1ï¼Œä¸‹é¢å¼¯é’©åƒ ã¡ çš„éª¨æ¶ã€‚", "shape": "æ¨ª + å‹¾ã€‚"},
            "ãƒ„": {
                "roma": "tsu",
                "memory": "åƒä¸‰æ»´æ°´å¾€ä¸‹è½ï¼Œæ˜¯å¹³å‡åã¤çš„ç«–ç‰ˆã€‚",
                "shape": "ä¸‰å°ç‚¹ç«–æ’ã€‚",
                "highlightParts": ["ä¸‰ç‚¹æ¨ªå‘æ’åˆ—"],
                "confusions": [
                    {"char": "ã‚·", "reason": "ã‚· çš„ä¸‰ç‚¹æ˜¯ç«–å‘æ’åˆ—ï¼Œè€Œ ãƒ„ çš„ä¸‰ç‚¹æ˜¯æ¨ªå‘æ’åˆ—ï¼Œå…³é”®å·®å¼‚ï¼šç«– vs æ¨ª"}
                ]
            },
            "ãƒ†": {"roma": "te", "memory": "åƒä¸€ä¸ªä¼¸å‡ºå»çš„åå­—æ‰‹è‡‚ï¼ˆæ‰‹=teï¼‰ã€‚", "shape": "åå­—ç»“æ„ã€‚"},
            "ãƒˆ": {"roma": "to", "memory": "åˆ€çš„ä¸€ç¬”ï¼Œtoâ†’æˆ³ä¸€ä¸‹å¾ˆç—›ï¼ˆã¨ï¼‰ã€‚", "shape": "ä¸€ç¬”æ–œé’©ã€‚"},

            // ãƒŠè¡Œ
            "ãƒŠ": {"roma": "na", "memory": "åƒä¸€ä¸ªäººè·ªä¸‹æ¥æ‹¿ä¸œè¥¿çš„å§¿åŠ¿ã€‚", "shape": "ç«– + å·¦å¼¯ç¬”ã€‚"},
            "ãƒ‹": {"roma": "ni", "memory": "ä¸¤æ¡å¹³è¡Œæ¨ªçº¿å°±æ˜¯äºŒï¼ˆã«ï¼‰ã€‚", "shape": "ä¸¤æ¨ªã€‚"},
            "ãƒŒ": {"roma": "nu", "memory": "å½¢çŠ¶åƒä¸€ä¸ªå¼¯æŠ˜çš„å‰å­ï¼Œnuâ†’ã€Œæ€’ã€æ—¶ç”©å‡ºçš„å½¢çŠ¶ã€‚", "shape": "å³æ–œ + ä¸‹æ–¹ U å½¢ã€‚"},
            "ãƒ": {"roma": "ne", "memory": "åƒæ±‰å­—ã€Œç¥¢ã€çš„æ‹†å¼€ç‰ˆï¼Œne çš„èµ·æºå½¢ã€‚", "shape": "å·¦ç«– + å³ä¸Šå‹¾ã€‚"},
            "ãƒ": {"roma": "no", "memory": "ç®€å•çš„ä¸€ç¬”æ–œçº¿ï¼Œå°±æ˜¯ no çš„å¦å®šåˆ’æ‰ã€‚", "shape": "å•æ–œçº¿ã€‚"},

            // ãƒè¡Œ
            "ãƒ": {"roma": "ha", "memory": "åƒä¸¤ç‰‡å¶å­åˆ†å¼€ï¼ˆã¯â†’å¶ï¼‰ã€‚", "shape": "ä¸¤ç¬”åˆ†å‰ã€‚"},
            "ãƒ’": {"roma": "hi", "memory": "åƒä¸€æ¡è¢«å‰Šå°–çš„åˆ€åˆƒï¼Œå‘ hi çš„æ°”éŸ³ã€‚", "shape": "å³ä¸‹å‹çš„çº¿ã€‚"},
            "ãƒ•": {"roma": "fu", "memory": "ä¸¤æ’‡åƒç«è‹—ï¼Œfuâ†’é£å¹ç«è‹—æ‘†åŠ¨ã€‚", "shape": "ä¸¤çŸ­æ’‡ã€‚"},
            "ãƒ˜": {"roma": "he", "memory": "åƒå±±å¡å°äºå·ï¼Œheâ†’å“ˆæ°”å¾€ä¸Šå¹ã€‚", "shape": "å•ä¸ª Vã€‚"},
            "ãƒ›": {"roma": "ho", "memory": "åå­—æ¶ + ç«–ï¼Œåƒæˆ¿å­çš„ç»“æ„ã€‚", "shape": "ä¸‰ç¬”äº¤å‰ã€‚"},

            // ãƒè¡Œ
            "ãƒ": {"roma": "ma", "memory": "åƒæ±‰å­—ã€Œãƒã€éŸ³çš„åŸå§‹å½¢ï¼Œmaâ†’å¦ˆæ‰‹å†™ç‰‡å‡åã€‚", "shape": "ä¸‰æ¨ª + å·¦ç«¯è£…é¥°ã€‚"},
            "ãƒŸ": {"roma": "mi", "memory": "ä¸‰æ¡å¹³è¡Œæ¨ªçº¿åƒä¸‰æ¡æµªï¼Œmiâ†’æ³¢çš„å£°éŸ³ã€‚", "shape": "ä¸‰æ¨ªã€‚"},
            "ãƒ ": {"roma": "mu", "memory": "åƒå˜´å·´é—­èµ·æ¥ï¼Œmuâ†’ã€Œå§†ã€çš„å£å‹ã€‚", "shape": "å³ä¸Šåˆ°å·¦ä¸‹çš„å¤§è§’åº¦æŠ˜ç¬”ã€‚"},
            "ãƒ¡": {"roma": "me", "memory": "åƒä¸€ä¸ªæ–œå‰ï¼Œæ˜¯å¹³å‡åã‚çš„é”‹åˆ©åŒ–ç‰ˆæœ¬ã€‚", "shape": "ä¸¤æ–œäº¤å‰ã€‚"},
            "ãƒ¢": {"roma": "mo", "memory": "ä¸Šä¸‹åˆ†å±‚åƒæ¯›ï¼ˆã‚‚ï¼‰çš„ç»“æ„ã€‚", "shape": "ä¸‰æ¨ª + ä¸€ç«–ã€‚"},

            // ãƒ¤è¡Œ
            "ãƒ¤": {"roma": "ya", "memory": "åƒä¸€ä¸ªåˆ†å‰çš„æ ‘æï¼Œyaâ†’ä¸«ã€‚", "shape": "ä¸€ç«– + ä¸€å¼¯ã€‚"},
            "ãƒ¦": {"roma": "yu", "memory": "åƒä¸€ä¸ªæµ´ç¼¸çš„æ–¹æ¡†ï¼ˆã‚†â†’æµ´ï¼‰ã€‚", "shape": "æ–¹æ¡†åŠ æ¨ªã€‚"},
            "ãƒ¨": {"roma": "yo", "memory": "ä¸‰æ¨ªåƒ yo yo çš„èŠ‚å¥ã€‚", "shape": "ä¸‰æ¨ªã€‚"},

            // ãƒ©è¡Œ
            "ãƒ©": {
                "roma": "ra",
                "memory": "åƒä¸€ä¸ªç”©å‡ºå»çš„ L å½¢ï¼Œraâ†’æ‹‰ã€‚",
                "shape": "å‘å³ç”©çš„ç¬”ã€‚",
                "highlightParts": ["ä¸Šæ¨ªä¸‹å¼¯"],
                "confusions": [
                    {"char": "ã‚¦", "reason": "ã‚¦ é¡¶éƒ¨æœ‰çŸ­æ¨ªå’Œå†…å‹¾ï¼Œè€Œ ãƒ© æ˜¯ç®€å•çš„ä¸Šæ¨ªä¸‹å¼¯ï¼Œå…³é”®å·®å¼‚ï¼šç»“æ„å¤æ‚åº¦ä¸åŒ"}
                ]
            },
            "ãƒª": {"roma": "ri", "memory": "ä¸¤ç¬”ç«–çº¿åƒä¸¤æ ¹ç­·å­ã€‚", "shape": "ä¸¤ç«–ã€‚"},
            "ãƒ«": {"roma": "ru", "memory": "å°¾å·´å·èµ·æ¥åƒé±¼é’©ï¼Œruâ†’ç»•ã€‚", "shape": "å‹¾å°¾ã€‚"},
            "ãƒ¬": {"roma": "re", "memory": "æ–œä¸‹çš„ä¸€ç¬”åƒæ’‡ä¸‹å»ï¼Œreâ†’è£‚ã€‚", "shape": "å•æ–œé’©ã€‚"},
            "ãƒ­": {"roma": "ro", "memory": "æ­£æ–¹å½¢ä¸‰è¾¹æ¡†ï¼Œåƒå£å­—å°‘ä¸€è¾¹ã€‚", "shape": "ã„‡å½¢å¤–æ¡†ã€‚"},

            // ãƒ¯è¡Œ
            "ãƒ¯": {
                "roma": "wa",
                "memory": "å·¦ç«–å³å‹¾åƒå“‡çš„ä¸€å£°ã€‚",
                "shape": "ç«–çº¿ + å¤§å‹¾ã€‚",
                "highlightParts": ["ç«–çº¿ + å¼¯å‹¾"],
                "confusions": [
                    {"char": "ã‚¦", "reason": "ã‚¦ é¡¶éƒ¨æœ‰çŸ­æ¨ªï¼Œè€Œ ãƒ¯ åªæœ‰ç«–çº¿+å¼¯å‹¾ï¼Œå…³é”®å·®å¼‚ï¼šé¡¶éƒ¨ç»“æ„ä¸åŒ"},
                    {"char": "ã‚¯", "reason": "ã‚¯ æ˜¯å•ä¸€çš„å¼¯å‹¾ï¼Œè€Œ ãƒ¯ æœ‰æ˜æ˜¾çš„å·¦ç«–ï¼Œå…³é”®å·®å¼‚ï¼šå·¦ä¾§æœ‰æ— ç«–çº¿"}
                ]
            },
            "ãƒ²": {"roma": "wo", "memory": "åƒåŠ äº†å°¾å·´çš„ãƒ­ï¼Œç‰¹æ®Š oã€‚", "shape": "åœ†å³ä¾§åŠ é’©ã€‚"},
            "ãƒ³": {
                "roma": "n",
                "memory": "åƒæ‰‹å†™ n çš„æ–œè§’ã€‚",
                "shape": "å³ä¸‹è·Œè½çš„ç¬”ã€‚",
                "highlightParts": ["ä¸¤ç‚¹å‘å·¦ä¸‹å€¾æ–œ"],
                "confusions": [
                    {"char": "ã‚½", "reason": "ã‚½ çš„ä¸¤ç‚¹å‘å³ä¸‹å€¾æ–œï¼Œè€Œ ãƒ³ çš„ä¸¤ç‚¹å‘å·¦ä¸‹å€¾æ–œï¼Œå…³é”®å·®å¼‚ï¼šæ–¹å‘ç›¸å"}
                ]
            }
        };

        // ç‰‡å‡åäº”åéŸ³é¡ºåº
        const katakanaOrder = [
            "ã‚¢", "ã‚¤", "ã‚¦", "ã‚¨", "ã‚ª",
            "ã‚«", "ã‚­", "ã‚¯", "ã‚±", "ã‚³",
            "ã‚µ", "ã‚·", "ã‚¹", "ã‚»", "ã‚½",
            "ã‚¿", "ãƒ", "ãƒ„", "ãƒ†", "ãƒˆ",
            "ãƒŠ", "ãƒ‹", "ãƒŒ", "ãƒ", "ãƒ",
            "ãƒ", "ãƒ’", "ãƒ•", "ãƒ˜", "ãƒ›",
            "ãƒ", "ãƒŸ", "ãƒ ", "ãƒ¡", "ãƒ¢",
            "ãƒ¤", "ãƒ¦", "ãƒ¨",
            "ãƒ©", "ãƒª", "ãƒ«", "ãƒ¬", "ãƒ­",
            "ãƒ¯", "ãƒ²", "ãƒ³"
        ];

        // è·å–å½“å‰æ¨¡å¼çš„æ•°æ®å’Œé¡ºåº
        function getCurrentData() {
            return currentMode === 'hiragana' ? hiraganaData : katakanaData;
        }

        function getCurrentOrder() {
            return currentMode === 'hiragana' ? hiraganaOrder : katakanaOrder;
        }

        function getConfusionList() {
            return currentMode === 'hiragana' ? hiraganaConfusionList : katakanaConfusionList;
        }

        // LocalStorage ç®¡ç†
        function getStorageKey(type) {
            const prefix = currentMode === 'hiragana' ? 'hiragana' : 'katakana';
            return `${prefix}_${type}`;
        }

        // è·å–é”™é¢˜è®°å½•
        function getErrors() {
            const data = localStorage.getItem(getStorageKey('errors'));
            return data ? JSON.parse(data) : {};
        }

        // ä¿å­˜é”™é¢˜è®°å½•
        function saveError(char) {
            const errors = getErrors();
            if (!errors[char]) {
                errors[char] = { count: 0, lastTime: null };
            }
            errors[char].count++;
            errors[char].lastTime = Date.now();
            localStorage.setItem(getStorageKey('errors'), JSON.stringify(errors));
            updateErrorBadge();
            updateGridErrorMarks();
        }

        // åˆ é™¤å•ä¸ªé”™é¢˜
        function removeError(char) {
            const errors = getErrors();
            delete errors[char];
            localStorage.setItem(getStorageKey('errors'), JSON.stringify(errors));
            updateErrorBadge();
            updateGridErrorMarks();
            showErrorBook(); // åˆ·æ–°é”™é¢˜æœ¬æ˜¾ç¤º
        }

        // æ¸…ç©ºæ‰€æœ‰é”™é¢˜
        function clearAllErrors() {
            const modeName = currentMode === 'hiragana' ? 'å¹³å‡å' : 'ç‰‡å‡å';
            if (confirm(`ç¡®å®šè¦æ¸…ç©º${modeName}çš„æ‰€æœ‰é”™é¢˜è®°å½•å—ï¼Ÿ`)) {
                localStorage.setItem(getStorageKey('errors'), JSON.stringify({}));
                updateErrorBadge();
                updateGridErrorMarks();
                showErrorBook();
            }
        }

        // è·å–ç»Ÿè®¡æ•°æ®
        function getStats() {
            const data = localStorage.getItem(getStorageKey('stats'));
            return data ? JSON.parse(data) : { total: 0, correct: 0, wrong: 0 };
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats(isCorrect) {
            const stats = getStats();
            stats.total++;
            if (isCorrect) {
                stats.correct++;
            } else {
                stats.wrong++;
            }
            localStorage.setItem(getStorageKey('stats'), JSON.stringify(stats));
        }

        // é‡ç½®ç»Ÿè®¡
        function resetStats() {
            const modeName = currentMode === 'hiragana' ? 'å¹³å‡å' : 'ç‰‡å‡å';
            if (confirm(`ç¡®å®šè¦é‡ç½®${modeName}çš„æ‰€æœ‰ç»Ÿè®¡æ•°æ®å—ï¼Ÿ`)) {
                localStorage.setItem(getStorageKey('stats'), JSON.stringify({ total: 0, correct: 0, wrong: 0 }));
                closeStatsModal();
            }
        }

        // æ›´æ–°é”™é¢˜å¾½ç« 
        function updateErrorBadge() {
            const errors = getErrors();
            const count = Object.keys(errors).length;
            const badge = document.getElementById('errorBadge');
            if (count > 0) {
                badge.textContent = count;
                badge.style.display = 'inline-block';
            } else {
                badge.style.display = 'none';
            }
        }

        // æ›´æ–°ç½‘æ ¼é”™é¢˜æ ‡è®°
        function updateGridErrorMarks() {
            const errors = getErrors();
            document.querySelectorAll('.hiragana-card').forEach(card => {
                const char = card.querySelector('.hiragana-char').textContent;
                if (errors[char]) {
                    card.classList.add('error-mark');
                } else {
                    card.classList.remove('error-mark');
                }
            });
        }

        // æ¸²æŸ“å‡åç½‘æ ¼
        function renderGrid() {
            const grid = document.getElementById('hiraganaGrid');
            grid.innerHTML = '';
            const order = getCurrentOrder();
            const data = getCurrentData();
            order.forEach(char => {
                const charData = data[char];
                const card = document.createElement('div');
                card.className = 'hiragana-card';
                card.innerHTML = `
                    <div class="hiragana-char">${char}</div>
                    <div class="hiragana-roma">${charData.roma}</div>
                `;
                card.onclick = () => openModal(char);
                grid.appendChild(card);
            });
            updateErrorBadge();
            updateGridErrorMarks();
        }

        // æ¨¡å¼åˆ‡æ¢
        function switchMode(mode) {
            if (currentMode === mode) return;
            currentMode = mode;

            // æ›´æ–°æ ‡ç­¾æ ·å¼
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.mode-tab.${mode}`).classList.add('active');

            // æ›´æ–°å‰¯æ ‡é¢˜
            const subtitle = document.getElementById('subtitle');
            if (mode === 'hiragana') {
                subtitle.textContent = 'å¹³å‡å Â· Hiragana Â· ä¼˜åŒ–åŠ©è®°ç‰ˆ';
            } else {
                subtitle.textContent = 'ç‰‡å‡å Â· Katakana Â· ä¼˜åŒ–åŠ©è®°ç‰ˆ';
            }

            // é‡æ–°æ¸²æŸ“ç½‘æ ¼
            renderGrid();
        }

        // æ‰“å¼€è¯¦æƒ… Modal
        function openModal(char) {
            const order = getCurrentOrder();
            const allData = getCurrentData();
            currentIndex = order.indexOf(char);
            const data = allData[char];
            document.getElementById('modalChar').textContent = char;
            document.getElementById('modalRoma').textContent = data.roma;
            document.getElementById('modalMemory').textContent = data.memory;
            document.getElementById('modalShape').textContent = data.shape;

            // å¤„ç† highlight å­—æ®µ
            const highlightSection = document.getElementById('modalHighlightSection');
            if (data.highlight) {
                document.getElementById('modalHighlight').textContent = data.highlight;
                highlightSection.style.display = 'block';
                highlightSection.classList.add('highlight-section');
            } else {
                highlightSection.style.display = 'none';
                highlightSection.classList.remove('highlight-section');
            }

            // å¤„ç† highlightParts å­—æ®µ
            const highlightPartsSection = document.getElementById('modalHighlightPartsSection');
            const highlightPartsContainer = document.getElementById('modalHighlightParts');
            if (data.highlightParts && data.highlightParts.length > 0) {
                highlightPartsContainer.innerHTML = data.highlightParts.map(part =>
                    `<span class="highlight-parts-item">${part}</span>`
                ).join('');
                highlightPartsSection.style.display = 'block';
            } else {
                highlightPartsSection.style.display = 'none';
            }

            // å¤„ç† confusions å­—æ®µ
            const confusionsSection = document.getElementById('modalConfusionsSection');
            const confusionsContainer = document.getElementById('modalConfusions');
            if (data.confusions && data.confusions.length > 0) {
                confusionsContainer.innerHTML = data.confusions.map(confusion => `
                    <div class="confusion-item">
                        <span class="confusion-char-link" onclick="openModal('${confusion.char}'); event.stopPropagation();">${confusion.char}</span>
                        <span class="confusion-reason">${confusion.reason}</span>
                    </div>
                `).join('');
                confusionsSection.style.display = 'block';
            } else {
                confusionsSection.style.display = 'none';
            }

            document.getElementById('modalOverlay').classList.add('active');
        }

        // å…³é—­è¯¦æƒ… Modal
        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        // ç‚¹å‡»èƒŒæ™¯å…³é—­
        document.getElementById('modalOverlay').addEventListener('click', closeModal);

        // ç½—é©¬éŸ³å®¹é”™åŒ¹é…
        function normalizeRomaji(input) {
            const normalized = input.toLowerCase().trim();
            const variants = {
                'si': 'shi',
                'ti': 'chi',
                'tu': 'tsu',
                'hu': 'fu',
                'zi': 'ji',
                'di': 'ji',
                'du': 'zu',
                'sya': 'sha',
                'syu': 'shu',
                'syo': 'sho',
                'tya': 'cha',
                'tyu': 'chu',
                'tyo': 'cho',
                'zya': 'ja',
                'zyu': 'ju',
                'zyo': 'jo',
                'wo': 'o'
            };
            return variants[normalized] || normalized;
        }

        // äº¤äº’æ¨¡å¼åˆ‡æ¢
        function switchInteractionMode(mode) {
            if (interactionMode === mode) return;
            interactionMode = mode;

            // æ›´æ–°æ ‡ç­¾æ ·å¼
            document.getElementById('quizInteractionInput').classList.remove('active');
            document.getElementById('quizInteractionChoice').classList.remove('active');
            if (mode === 'input') {
                document.getElementById('quizInteractionInput').classList.add('active');
            } else {
                document.getElementById('quizInteractionChoice').classList.add('active');
            }

            // åˆ‡æ¢æ˜¾ç¤º
            const inputContainer = document.getElementById('quizInputContainer');
            const optionsContainer = document.getElementById('quizOptions');
            if (mode === 'input') {
                inputContainer.style.display = 'flex';
                optionsContainer.style.display = 'none';
            } else {
                inputContainer.style.display = 'none';
                optionsContainer.style.display = 'grid';
            }

            // æ›´æ–°æ ‡ç­¾æ–‡å­—å¹¶å‡ºä¸‹ä¸€é¢˜
            updateQuizModeLabel();
            nextQuestion();
        }

        // æ··æ·†è®­ç»ƒæ¨¡å¼åˆ‡æ¢
        function toggleConfusionTraining() {
            confusionTrainingMode = !confusionTrainingMode;
            const btn = document.getElementById('confusionTrainingBtn');
            const text = document.getElementById('confusionTrainingText');

            if (confusionTrainingMode) {
                btn.classList.add('active');
                text.textContent = 'æ··æ·†è®­ç»ƒï¼šå¼€å¯';
            } else {
                btn.classList.remove('active');
                text.textContent = 'æ··æ·†è®­ç»ƒï¼šå…³é—­';
            }
        }

        // éšæœºæ£€æŸ¥åŠŸèƒ½
        let currentQuestion = null;
        let quizSessionStats = { correct: 0, wrong: 0 };
        let recentQuestions = []; // è®°å½•æœ€è¿‘å‡ºè¿‡çš„é¢˜ç›®,é¿å…çŸ­æœŸé‡å¤

        // å®Œæ•´æµ‹éªŒåŠŸèƒ½
        let isFullTestMode = false; // æ˜¯å¦æ˜¯å®Œæ•´æµ‹éªŒæ¨¡å¼
        let fullTestQuestions = []; // å®Œæ•´æµ‹éªŒçš„é¢˜ç›®åˆ—è¡¨(å·²æ‰“æ•£)
        let fullTestIndex = 0; // å½“å‰é¢˜ç›®ç´¢å¼•
        let fullTestStats = { correct: 0, wrong: 0 }; // å®Œæ•´æµ‹éªŒç»Ÿè®¡

        function startQuiz() {
            isFullTestMode = false;
            quizSessionStats = { correct: 0, wrong: 0 };
            recentQuestions = []; // æ¸…ç©ºå†å²è®°å½•
            document.getElementById('quizProgress').style.display = 'none'; // éšè—è¿›åº¦
            updateQuizStats();
            updateQuizModeLabel();
            nextQuestion();
            document.getElementById('quizModal').classList.add('active');
        }

        // Fisher-Yates æ´—ç‰Œç®—æ³•
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // å¼€å§‹å®Œæ•´æµ‹éªŒ
        function startFullTest() {
            isFullTestMode = true;
            fullTestStats = { correct: 0, wrong: 0 };
            fullTestIndex = 0;

            // è·å–æ‰€æœ‰å‡åå¹¶æ‰“æ•£
            const order = getCurrentOrder();
            fullTestQuestions = shuffleArray(order);

            // æ˜¾ç¤ºè¿›åº¦
            document.getElementById('quizProgress').style.display = 'block';
            updateFullTestProgress();

            updateQuizModeLabel();
            nextQuestion();
            document.getElementById('quizModal').classList.add('active');
        }

        // æ›´æ–°å®Œæ•´æµ‹éªŒè¿›åº¦
        function updateFullTestProgress() {
            const progressText = document.getElementById('quizProgressText');
            progressText.textContent = `ç¬¬ ${fullTestIndex + 1} / ${fullTestQuestions.length} é¢˜`;
        }

        function closeQuizModal() {
            document.getElementById('quizModal').classList.remove('active');
        }

        function switchQuizType(type) {
            if (quizType === type) return;
            quizType = type;

            // æ›´æ–°æ ‡ç­¾æ ·å¼
            document.getElementById('quizTypeRomaToKana').classList.remove('active');
            document.getElementById('quizTypeKanaToRoma').classList.remove('active');
            if (type === 'roma-to-kana') {
                document.getElementById('quizTypeRomaToKana').classList.add('active');
            } else {
                document.getElementById('quizTypeKanaToRoma').classList.add('active');
            }

            // æ›´æ–°æ ‡ç­¾æ–‡å­—å¹¶å‡ºä¸‹ä¸€é¢˜
            updateQuizModeLabel();
            nextQuestion();
        }

        function updateQuizModeLabel() {
            const label = document.getElementById('quizModeLabel');
            const modeName = currentMode === 'hiragana' ? 'å¹³å‡å' : 'ç‰‡å‡å';

            let questionType;
            if (interactionMode === 'input') {
                questionType = quizType === 'roma-to-kana' ? 'è¯·è¾“å…¥å¯¹åº”çš„å‡å' : 'è¯·è¾“å…¥ç½—é©¬éŸ³';
            } else {
                questionType = quizType === 'roma-to-kana' ? 'è¯·é€‰æ‹©æ­£ç¡®çš„å‡å' : 'è¯·é€‰æ‹©æ­£ç¡®çš„ç½—é©¬éŸ³';
            }

            if (isFullTestMode) {
                label.textContent = `${modeName}å®Œæ•´æµ‹éªŒ - ${questionType}`;
            } else if (confusionTrainingMode) {
                label.textContent = `${modeName}æ··æ·†è®­ç»ƒ - ${questionType}`;
            } else {
                label.textContent = `${modeName}æµ‹è¯• - ${questionType}`;
            }
        }

        function nextQuestion() {
            // éšè—ç»“æœ
            const resultDiv = document.getElementById('quizResult');
            resultDiv.classList.add('hidden');
            resultDiv.classList.remove('correct', 'wrong');

            // æ¸…ç©ºå¹¶é‡ç½®è¾“å…¥æ¡†
            const inputElement = document.getElementById('quizInput');
            inputElement.value = '';
            inputElement.classList.remove('correct', 'wrong');
            inputElement.disabled = false;

            const data = getCurrentData();
            let correctChar;

            // å®Œæ•´æµ‹éªŒæ¨¡å¼ï¼šæŒ‰é¡ºåºå‡ºé¢˜
            if (isFullTestMode) {
                correctChar = fullTestQuestions[fullTestIndex];
                currentQuestion = correctChar;
            } else {
                // éšæœºæ£€æŸ¥æ¨¡å¼ï¼šæ™ºèƒ½é€‰é¢˜
                const order = getCurrentOrder();
                const confusionList = getConfusionList();
                const sourceList = confusionTrainingMode ? confusionList : order;

                // æ™ºèƒ½é€‰é¢˜:æ’é™¤æœ€è¿‘å‡ºè¿‡çš„é¢˜ç›®,ç¡®ä¿è¦†ç›–é¢å¹¿ä¸”ç¦»æ•£
                let availableChars = [...sourceList];

                // è®¡ç®—å†å²è®°å½•ä¿ç•™æ•°é‡(æ ¹æ®é¢˜åº“å¤§å°åŠ¨æ€è°ƒæ•´)
                const historySize = Math.min(
                    Math.floor(sourceList.length * 0.4), // ä¿ç•™æœ€å¤š40%çš„é¢˜åº“å¤§å°
                    7 // æœ€å¤šä¿ç•™7é¢˜å†å²
                );

                // å¦‚æœæœ‰è¶³å¤Ÿçš„å€™é€‰é¡¹,æ’é™¤æœ€è¿‘çš„é¢˜ç›®
                if (sourceList.length > 3 && recentQuestions.length > 0) {
                    availableChars = sourceList.filter(char => !recentQuestions.includes(char));

                    // å¦‚æœè¿‡æ»¤åå€™é€‰é¡¹å¤ªå°‘(å°‘äº3ä¸ª),åªæ’é™¤æœ€è¿‘1é¢˜
                    if (availableChars.length < 3) {
                        availableChars = sourceList.filter(char => char !== recentQuestions[recentQuestions.length - 1]);
                    }
                }

                // ä»å¯ç”¨æ± ä¸­éšæœºé€‰æ‹©
                correctChar = availableChars[Math.floor(Math.random() * availableChars.length)];
                currentQuestion = correctChar;

                // æ›´æ–°å†å²è®°å½•
                recentQuestions.push(correctChar);
                if (recentQuestions.length > historySize) {
                    recentQuestions.shift(); // ç§»é™¤æœ€æ—©çš„è®°å½•
                }
            }

            const optionsContainer = document.getElementById('quizOptions');
            optionsContainer.innerHTML = '';

            // è¾“å…¥æ¨¡å¼
            if (interactionMode === 'input') {
                const confusionCandidatesDiv = document.getElementById('confusionCandidates');

                if (quizType === 'kana-to-roma') {
                    // æ˜¾ç¤ºå‡åï¼Œè¾“å…¥ç½—é©¬éŸ³
                    document.getElementById('quizTarget').textContent = correctChar;
                    inputElement.placeholder = 'è¾“å…¥ç½—é©¬éŸ³...';

                    // æ··æ·†å¯¹å†³æ¨¡å¼ï¼šæ˜¾ç¤ºå€™é€‰å‡å
                    if (confusionTrainingMode) {
                        const candidates = [correctChar];
                        // æ·»åŠ 2-3ä¸ªå…¶ä»–æ··æ·†å‡å
                        while (candidates.length < Math.min(4, sourceList.length)) {
                            const randomChar = sourceList[Math.floor(Math.random() * sourceList.length)];
                            if (!candidates.includes(randomChar)) {
                                candidates.push(randomChar);
                            }
                        }
                        // æ‰“ä¹±é¡ºåº
                        candidates.sort(() => Math.random() - 0.5);

                        confusionCandidatesDiv.innerHTML = candidates.map(char =>
                            `<div class="confusion-candidate">${char}</div>`
                        ).join('');
                        confusionCandidatesDiv.style.display = 'flex';
                    } else {
                        confusionCandidatesDiv.style.display = 'none';
                    }
                } else {
                    // æ˜¾ç¤ºç½—é©¬éŸ³ï¼Œè¾“å…¥å‡å
                    document.getElementById('quizTarget').textContent = data[correctChar].roma.toUpperCase();
                    inputElement.placeholder = 'è¾“å…¥å‡å...';

                    // æ··æ·†å¯¹å†³æ¨¡å¼ï¼šæ˜¾ç¤ºå€™é€‰å‡å
                    if (confusionTrainingMode) {
                        const candidates = [correctChar];
                        while (candidates.length < Math.min(4, sourceList.length)) {
                            const randomChar = sourceList[Math.floor(Math.random() * sourceList.length)];
                            if (!candidates.includes(randomChar)) {
                                candidates.push(randomChar);
                            }
                        }
                        candidates.sort(() => Math.random() - 0.5);

                        confusionCandidatesDiv.innerHTML = candidates.map(char =>
                            `<div class="confusion-candidate">${char}</div>`
                        ).join('');
                        confusionCandidatesDiv.style.display = 'flex';
                    } else {
                        confusionCandidatesDiv.style.display = 'none';
                    }
                }
                // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
                setTimeout(() => inputElement.focus(), 100);
                return;
            }

            // é€‰æ‹©æ¨¡å¼
            if (quizType === 'roma-to-kana') {
                // æ¨¡å¼1ï¼šæ˜¾ç¤ºç½—é©¬éŸ³ï¼Œé€‰æ‹©å‡å
                document.getElementById('quizTarget').textContent = data[correctChar].roma.toUpperCase();

            // ç”Ÿæˆé€‰é¡¹ï¼ˆ1ä¸ªæ­£ç¡® + 3ä¸ªé”™è¯¯ï¼‰
            const options = [correctChar];
            while (options.length < 4) {
                const randomChar = sourceList[Math.floor(Math.random() * sourceList.length)];
                if (!options.includes(randomChar)) {
                    options.push(randomChar);
                }
            }

            // æ‰“ä¹±é€‰é¡¹é¡ºåº
            options.sort(() => Math.random() - 0.5);

            // æ¸²æŸ“é€‰é¡¹
            options.forEach(char => {
                const option = document.createElement('div');
                option.className = 'quiz-option';
                    option.dataset.char = char;
                    option.dataset.roma = data[char].roma;
                option.innerHTML = `
                    <div class="quiz-option-char">${char}</div>
                        <div class="quiz-option-roma">${data[char].roma}</div>
                `;
                option.onclick = () => checkAnswer(char, option);
                optionsContainer.appendChild(option);
            });
            } else {
                // æ¨¡å¼2ï¼šæ˜¾ç¤ºå‡åï¼Œé€‰æ‹©ç½—é©¬éŸ³
                document.getElementById('quizTarget').textContent = correctChar;

                // è·å–æ­£ç¡®çš„ç½—é©¬éŸ³
                const correctRoma = data[correctChar].roma;

                // ç”Ÿæˆç½—é©¬éŸ³é€‰é¡¹ï¼ˆ1ä¸ªæ­£ç¡® + 3ä¸ªé”™è¯¯ï¼‰
                const romaOptions = [correctRoma];
                const allRomas = [...new Set(order.map(c => data[c].roma))]; // è·å–æ‰€æœ‰ä¸é‡å¤çš„ç½—é©¬éŸ³

                while (romaOptions.length < 4) {
                    const randomRoma = allRomas[Math.floor(Math.random() * allRomas.length)];
                    if (!romaOptions.includes(randomRoma)) {
                        romaOptions.push(randomRoma);
                    }
                }

                // æ‰“ä¹±é€‰é¡¹é¡ºåº
                romaOptions.sort(() => Math.random() - 0.5);

                // æ¸²æŸ“é€‰é¡¹
                romaOptions.forEach(roma => {
                    const option = document.createElement('div');
                    option.className = 'quiz-option roma-option';
                    option.dataset.roma = roma;
                    option.innerHTML = `
                        <div class="quiz-option-roma-main">${roma.toUpperCase()}</div>
                    `;
                    option.onclick = () => checkAnswerRoma(roma, option, correctRoma);
                    optionsContainer.appendChild(option);
                });
            }
        }

        // æ£€æŸ¥è¾“å…¥ç­”æ¡ˆ
        function checkInputAnswer() {
            const inputElement = document.getElementById('quizInput');
            const userInput = inputElement.value.trim();

            if (!userInput) {
                return; // ç©ºè¾“å…¥ä¸å¤„ç†
            }

            const data = getCurrentData();
            let isCorrect = false;

            if (quizType === 'kana-to-roma') {
                // å‡å â†’ ç½—é©¬éŸ³æ¨¡å¼ï¼šæ”¯æŒå®¹é”™
                const correctRoma = data[currentQuestion].roma;
                const normalizedInput = normalizeRomaji(userInput);
                const normalizedCorrect = normalizeRomaji(correctRoma);
                isCorrect = normalizedInput === normalizedCorrect;
            } else {
                // ç½—é©¬éŸ³ â†’ å‡åæ¨¡å¼ï¼šå®Œå…¨åŒ¹é…
                isCorrect = userInput === currentQuestion;
            }

            // ç¦ç”¨è¾“å…¥æ¡†
            inputElement.disabled = true;

            // æ ‡è®°è¾“å…¥æ¡†
            if (isCorrect) {
                inputElement.classList.add('correct');
                if (isFullTestMode) {
                    fullTestStats.correct++;
                } else {
                    quizSessionStats.correct++;
                }
            } else {
                inputElement.classList.add('wrong');
                if (isFullTestMode) {
                    fullTestStats.wrong++;
                } else {
                    quizSessionStats.wrong++;
                }
                saveError(currentQuestion);
            }

            // æ›´æ–°ç»Ÿè®¡
            updateStats(isCorrect);
            if (isFullTestMode) {
                updateFullTestStats();
            } else {
                updateQuizStats();
            }

            // æ˜¾ç¤ºç»“æœ
            const resultDiv = document.getElementById('quizResult');
            resultDiv.classList.remove('hidden');
            resultDiv.className = `quiz-result ${isCorrect ? 'correct' : 'wrong'}`;

            if (isCorrect) {
                resultDiv.textContent = 'âœ“ å›ç­”æ­£ç¡®ï¼';
            } else {
                if (quizType === 'kana-to-roma') {
                    resultDiv.textContent = `âœ— å›ç­”é”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${data[currentQuestion].roma}`;
                } else {
                    resultDiv.textContent = `âœ— å›ç­”é”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${currentQuestion}`;
                }
            }

            // å¦‚æœå›ç­”æ­£ç¡®ï¼Œ800msåè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€é¢˜
            if (isCorrect) {
                setTimeout(() => {
                    if (document.getElementById('quizModal').classList.contains('active')) {
                        proceedToNextOrFinish();
                    }
                }, 800);
            }
        }

        // è¿›å…¥ä¸‹ä¸€é¢˜æˆ–å®Œæˆæµ‹éªŒ
        function proceedToNextOrFinish() {
            if (isFullTestMode) {
                fullTestIndex++;
                if (fullTestIndex >= fullTestQuestions.length) {
                    // æµ‹éªŒå®Œæˆ
                    finishFullTest();
                } else {
                    // ç»§ç»­ä¸‹ä¸€é¢˜
                    updateFullTestProgress();
                    nextQuestion();
                }
            } else {
                nextQuestion();
            }
        }

        function checkAnswer(selectedChar, optionElement) {
            const isCorrect = selectedChar === currentQuestion;

            // ç¦ç”¨æ‰€æœ‰é€‰é¡¹
            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.add('disabled');
            });

            // æ ‡è®°é€‰ä¸­çš„é€‰é¡¹
            if (isCorrect) {
                optionElement.classList.add('correct');
                if (isFullTestMode) {
                    fullTestStats.correct++;
                } else {
                    quizSessionStats.correct++;
                }
            } else {
                optionElement.classList.add('wrong');
                if (isFullTestMode) {
                    fullTestStats.wrong++;
                } else {
                    quizSessionStats.wrong++;
                }
                saveError(currentQuestion);

                // æ ‡è®°æ­£ç¡®ç­”æ¡ˆï¼Œå¹¶æ˜¾ç¤ºæ‰€æœ‰é€‰é¡¹çš„ç½—é©¬éŸ³
                document.querySelectorAll('.quiz-option').forEach(opt => {
                    opt.classList.add('show-roma'); // æ˜¾ç¤ºç½—é©¬éŸ³
                    if (opt.dataset.char === currentQuestion) {
                        opt.classList.add('correct');
                    }
                });
            }

            // æ›´æ–°ç»Ÿè®¡
            updateStats(isCorrect);
            if (isFullTestMode) {
                updateFullTestStats();
            } else {
                updateQuizStats();
            }

            // æ˜¾ç¤ºç»“æœ
            const resultDiv = document.getElementById('quizResult');
            resultDiv.classList.remove('hidden');
            resultDiv.className = `quiz-result ${isCorrect ? 'correct' : 'wrong'}`;
            resultDiv.textContent = isCorrect ?
                'âœ“ å›ç­”æ­£ç¡®ï¼' :
                `âœ— å›ç­”é”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${currentQuestion}`;

            // å¦‚æœå›ç­”æ­£ç¡®ï¼Œ800msåè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€é¢˜
            if (isCorrect) {
                setTimeout(() => {
                    if (document.getElementById('quizModal').classList.contains('active')) {
                        proceedToNextOrFinish();
                    }
                }, 800);
            }
        }

        // å‡åâ†’ç½—é©¬éŸ³æ¨¡å¼çš„ç­”æ¡ˆæ£€æŸ¥
        function checkAnswerRoma(selectedRoma, optionElement, correctRoma) {
            const isCorrect = selectedRoma === correctRoma;
            const data = getCurrentData();

            // ç¦ç”¨æ‰€æœ‰é€‰é¡¹
            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.add('disabled');
            });

            // æ ‡è®°é€‰ä¸­çš„é€‰é¡¹
            if (isCorrect) {
                optionElement.classList.add('correct');
                if (isFullTestMode) {
                    fullTestStats.correct++;
                } else {
                    quizSessionStats.correct++;
                }
            } else {
                optionElement.classList.add('wrong');
                if (isFullTestMode) {
                    fullTestStats.wrong++;
                } else {
                    quizSessionStats.wrong++;
                }
                saveError(currentQuestion);

                // æ ‡è®°æ­£ç¡®ç­”æ¡ˆ
                document.querySelectorAll('.quiz-option').forEach(opt => {
                    if (opt.dataset.roma === correctRoma) {
                        opt.classList.add('correct');
                    }
                });
            }

            // æ›´æ–°ç»Ÿè®¡
            updateStats(isCorrect);
            if (isFullTestMode) {
                updateFullTestStats();
            } else {
                updateQuizStats();
            }

            // æ˜¾ç¤ºç»“æœ
            const resultDiv = document.getElementById('quizResult');
            resultDiv.classList.remove('hidden');
            resultDiv.className = `quiz-result ${isCorrect ? 'correct' : 'wrong'}`;
            resultDiv.textContent = isCorrect ?
                'âœ“ å›ç­”æ­£ç¡®ï¼' :
                `âœ— å›ç­”é”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${correctRoma.toUpperCase()}`;

            // å¦‚æœå›ç­”æ­£ç¡®ï¼Œ800msåè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€é¢˜
            if (isCorrect) {
                setTimeout(() => {
                    if (document.getElementById('quizModal').classList.contains('active')) {
                        proceedToNextOrFinish();
                    }
                }, 800);
            }
        }

        function updateQuizStats() {
            document.getElementById('quizCorrect').textContent = quizSessionStats.correct;
            document.getElementById('quizWrong').textContent = quizSessionStats.wrong;
            const total = quizSessionStats.correct + quizSessionStats.wrong;
            const accuracy = total > 0 ? Math.round((quizSessionStats.correct / total) * 100) : 0;
            document.getElementById('quizAccuracy').textContent = accuracy + '%';
        }

        function updateFullTestStats() {
            document.getElementById('quizCorrect').textContent = fullTestStats.correct;
            document.getElementById('quizWrong').textContent = fullTestStats.wrong;
            const total = fullTestStats.correct + fullTestStats.wrong;
            const accuracy = total > 0 ? Math.round((fullTestStats.correct / total) * 100) : 0;
            document.getElementById('quizAccuracy').textContent = accuracy + '%';
        }

        // å®Œæˆå®Œæ•´æµ‹éªŒ
        function finishFullTest() {
            closeQuizModal();

            const total = fullTestQuestions.length;
            const correct = fullTestStats.correct;
            const wrong = fullTestStats.wrong;
            const accuracy = Math.round((correct / total) * 100);

            const modeName = currentMode === 'hiragana' ? 'å¹³å‡å' : 'ç‰‡å‡å';
            document.getElementById('resultModalTitle').textContent = `${modeName}å®Œæ•´æµ‹éªŒ`;
            document.getElementById('resultTotal').textContent = total;
            document.getElementById('resultCorrect').textContent = correct;
            document.getElementById('resultWrong').textContent = wrong;
            document.getElementById('resultAccuracy').textContent = accuracy + '%';

            // è¯„çº§å’Œè¯„è¯­
            let grade = '';
            let comment = '';
            if (accuracy === 100) {
                grade = 'ğŸ† å®Œç¾';
                comment = 'å¤ªæ£’äº†ï¼ä½ å·²ç»å®Œå…¨æŒæ¡äº†æ‰€æœ‰å‡åï¼';
            } else if (accuracy >= 90) {
                grade = 'ğŸŒŸ ä¼˜ç§€';
                comment = 'åšå¾—å¾ˆå¥½ï¼ç»§ç»­ä¿æŒï¼';
            } else if (accuracy >= 80) {
                grade = 'ğŸ‘ è‰¯å¥½';
                comment = 'ä¸é”™çš„è¡¨ç°ï¼å†æ¥å†å‰ï¼';
            } else if (accuracy >= 70) {
                grade = 'ğŸ“š åŠæ ¼';
                comment = 'è¿˜éœ€è¦å¤šç»ƒä¹ å“¦~';
            } else if (accuracy >= 60) {
                grade = 'ğŸ’ª åŠ æ²¹';
                comment = 'åˆ«æ°”é¦ï¼Œå¤šå¤ä¹ é”™é¢˜å§ï¼';
            } else {
                grade = 'ğŸ“– ç»§ç»­åŠªåŠ›';
                comment = 'å»ºè®®å…ˆå­¦ä¹ ä¸€éå†æ¥æµ‹éªŒ~';
            }

            document.getElementById('resultGrade').textContent = grade;
            document.getElementById('resultComment').textContent = comment;

            document.getElementById('resultModal').classList.add('active');
        }

        function closeResultModal() {
            document.getElementById('resultModal').classList.remove('active');
        }

        function retakeFullTest() {
            closeResultModal();
            startFullTest();
        }

        // é”™é¢˜æœ¬
        function showErrorBook() {
            const errors = getErrors();
            const errorContent = document.getElementById('errorContent');
            const data = getCurrentData();
            const modeName = currentMode === 'hiragana' ? 'å¹³å‡å' : 'ç‰‡å‡å';

            document.getElementById('errorModalTitle').textContent = `${modeName}é”™é¢˜æœ¬`;

            if (Object.keys(errors).length === 0) {
                errorContent.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">âœ“</div>
                        <div class="empty-text">${modeName}è¿˜æ²¡æœ‰é”™é¢˜è®°å½•</div>
                    </div>
                `;
            } else {
                const errorList = Object.entries(errors)
                    .sort((a, b) => b[1].count - a[1].count)
                    .map(([char, errData]) => {
                        return `
                            <div class="error-item">
                                <div class="error-item-left">
                                    <div class="error-char">${char}</div>
                                    <div class="error-info">
                                        <div class="error-roma">${data[char].roma}</div>
                                        <div class="error-count">é”™è¯¯ ${errData.count} æ¬¡</div>
                                    </div>
                                </div>
                                <div class="error-actions">
                                    <button class="error-btn review" onclick="reviewError('${char}')">å¤ä¹ </button>
                                    <button class="error-btn remove" onclick="removeError('${char}')">ç§»é™¤</button>
                                </div>
                            </div>
                        `;
                    }).join('');

                errorContent.innerHTML = `<div class="error-list">${errorList}</div>`;
            }

            document.getElementById('errorModal').classList.add('active');
        }

        function closeErrorModal() {
            document.getElementById('errorModal').classList.remove('active');
        }

        function reviewError(char) {
            closeErrorModal();
            openModal(char);
        }

        // å­¦ä¹ ç»Ÿè®¡
        function showStats() {
            const stats = getStats();
            const modeName = currentMode === 'hiragana' ? 'å¹³å‡å' : 'ç‰‡å‡å';

            document.getElementById('statsModalTitle').textContent = `${modeName}å­¦ä¹ ç»Ÿè®¡`;
            document.getElementById('statTotal').textContent = stats.total;
            document.getElementById('statCorrect').textContent = stats.correct;
            document.getElementById('statWrong').textContent = stats.wrong;

            const accuracy = stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0;
            document.getElementById('statAccuracy').textContent = accuracy + '%';

            document.getElementById('statsModal').classList.add('active');
        }

        function closeStatsModal() {
            document.getElementById('statsModal').classList.remove('active');
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            // ESC å…³é—­æ‰€æœ‰å¼¹çª—
            if (e.key === 'Escape') {
                closeModal();
                closeQuizModal();
                closeErrorModal();
                closeStatsModal();
                closeResultModal();
            }

            // å¦‚æœæµ‹éªŒå¼¹çª—æ‰“å¼€ä¸”å¤„äºè¾“å…¥æ¨¡å¼
            if (document.getElementById('quizModal').classList.contains('active') && interactionMode === 'input') {
                const inputElement = document.getElementById('quizInput');

                if (e.key === 'Enter') {
                    e.preventDefault();
                    // å¦‚æœè¾“å…¥æ¡†å·²ç¦ç”¨ï¼ˆå·²ç­”é¢˜ï¼‰ï¼Œè¿›å…¥ä¸‹ä¸€é¢˜
                    if (inputElement.disabled) {
                        nextQuestion();
                    } else {
                        // å¦åˆ™æäº¤ç­”æ¡ˆ
                        checkInputAnswer();
                    }
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    // è·³è¿‡å½“å‰é¢˜ç›®ï¼ˆå®Œæ•´æµ‹éªŒæ¨¡å¼ä¸‹ä¹Ÿè¿›å…¥ä¸‹ä¸€é¢˜ï¼‰
                    if (!inputElement.disabled) {
                        proceedToNextOrFinish();
                    }
                }
            }
        });

        // ç‚¹å‡»èƒŒæ™¯å…³é—­
        document.getElementById('quizModal').addEventListener('click', closeQuizModal);
        document.getElementById('errorModal').addEventListener('click', closeErrorModal);
        document.getElementById('statsModal').addEventListener('click', closeStatsModal);
        document.getElementById('resultModal').addEventListener('click', closeResultModal);

        // åˆå§‹åŒ–
        renderGrid();

        // æ³¨å†Œ Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('Service Worker æ³¨å†ŒæˆåŠŸ:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker æ³¨å†Œå¤±è´¥:', error);
                    });
            });
        }
    </script>
</body>
</html>
